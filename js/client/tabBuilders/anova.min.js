!function(){"use strict";var e,t=[require("peptide_picker"),require("bs_toggle-js")];require("bs_toggle-css","style"),e=function(e,t){var a,r,i,n,l,o,p,c,s,u,d,h,g,m,f,v,k={},b={linear:{},kinetic:{}},y={},x="linear",N={linear:2,kinetic:2};k.div=e,y.linear={param:0,params:t[0].linear.equation.mathParams},y.kinetic={param:0,params:t[0].kinetic.equation.mathParams},i=KINOME.peptidePicker(t),k.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),k.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),o=function(e,t){return e.signal.parameters[y[t].param]},p=function(e,t){return e.background.parameters[y[t].param]},u=function(e,a){var r,i,n,l,o,p=[];if("kinetic"===a?(n=e.exposure,l={type:a,exposure:e.exposure}):(n=e.cycle,l={type:a,cycle:e.cycle}),b[a][y[a].param]=b[a][y[a].param]||{},void 0!==b[a][y[a].param][n])o=b[a][y[a].param][n];else{for(r=t.get(l),i=0;i<r.length;i+=1)p.push(r[i].signal.parameters[y[a].param]-r[i].background.parameters[y[a].param]);o=(p=p.sort(function(e,t){return e-t}))[Math.floor(p.length/20)-1],b[a][y[a].param][n]=o}return e.signal.parameters[y[a].param]-e.background.parameters[y[a].param]<o?NaN:Math.log(e.signal.parameters[y[a].param]-e.background.parameters[y[a].param]-o+1)/Math.log(2)},l={kinetic:s=function(e,t){return Math.log(e.signal.parameters[y[t].param]/e.background.parameters[y[t].param])/Math.log(2)},linear:s},d=function(e){var a,r,i,n={kinetic:[],linear:[]};if(i=function(a,r,i){n.kinetic[r]=n.kinetic[r]||[],n.linear[r]=n.linear[r]||[],n.kinetic[r]=n.kinetic[r].concat(t.get({exposure:e.exposure,type:"kinetic",group:i,peptide:a})),n.linear[r]=n.linear[r].concat(t.get({cycle:e.cycle,type:"linear",group:i,peptide:a}))},m=e,r=t.list("groups"),e.peptide)for(a=0;a<r.length;a+=1)i(e.peptide,a,r[a]);else k.kinetic.fig.empty(),k.kinetic.f_val.empty(),k.linear.fig.empty(),k.linear.f_val.empty();n.kinetic.length&&n.linear.length&&h(n,r)},v=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},g=function(e,t,a,r){return'<div style="min-width: 170px; padding:5px;">(Group: '+e+", Value:"+t.toFixed(2)+'), <div>(<a target="_blank" href="'+a.lvl_1+'">'+a.name+"</a>, peptide: "+a.peptide+"<br />"+r+": "+a[r]+"</div>"};var C=function(e){return e};c=function(e,t,a,r){var i,n,o,p,c,s,u=[["Group Number"]],d=["X"],h=[];for(i=0;i<r.length;i+=1)u[0].push("G"+i),u[0].push({type:"string",role:"tooltip",p:{html:!0}}),d.push(NaN),d.push(""),h.push([]);for(i=0;i<e[t].length;i+=1)for(n=0;n<e[t][i].length;n+=1)c=2*e[t][i][n].group+1,o=e[t][i][n].group+(.3*Math.random()-.15),p=l[t](e[t][i][n],t),h[e[t][i][n].group].push(p),(s=d.map(C))[0]=o,s[c]=p,s[c+1]=g(e[t][i][n].group,p,e[t][i][n],a),u.push(s);return{chart:u,stats:h}},n=function(e,r){var i,n,o,p,c,s,u,d=t.list("groups"),h=1/0,g=-1/0,m=[];for(n=0;n<e[x].length;n+=1){for(c=[],i=0;i<d.length;i+=1){for(s=t.get({peptide:e[x][n].peptide,exposure:r.exposure,cycle:r.cycle,type:x,group:d[i]}),u=[],o=0;o<s.length;o+=1)u.push(l[x](s[o],x));c.push(u)}p=a(c),Number.isNaN(p)||(h=Math.min(h,p),g=Math.max(g,p)),m.push(p)}return Promise.resolve(m.map(function(e){return Number.isNaN(e)?0:(e-h)/(g-h)}))},f=function(e,t){var r=google.visualization.arrayToDataTable(e.chart),i={title:"Reproducibility - "+v(t),titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"24"},hAxis:{title:y[t].params[y[t].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},vAxis:{title:y[t].params[y[t].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},legend:"none",tooltip:{isHtml:!0,trigger:"both"},seriesType:"scatter",height:.68*k.width.width(),width:k.width.width()},n=new google.visualization.ComboChart(k[t].fig[0]);google.visualization.events.addListener(n,"ready",function(){$.each($("text"),function(e,t){var a=$(t).text();return a.match(/_|\^/)&&(a=(a=a.replace(/_([^\{])|_\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="sub">$1$2</tspan>')).replace(/\^([^\{])|\^\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="super">$1$2</tspan>'),$(t).html(a)),e})}),n.draw(r,i),k[t].f_val.text("f-test = "+a(e.stats).toFixed(5))},h=function(e,t){var a,r;(r=c(e,"kinetic","exposure",t)).chart.length>1&&f(r,"kinetic"),(a=c(e,"linear","cycle",t)).chart.length>1&&f(a,"linear")},a=function(){var e=function(e,t){return e+t},t=function(t){return t.reduce(e)/t.length},a=function(e,a){var r,i=0;for(a=a||t(e),r=0;r<e.length;r+=1)i+=Math.pow(e[r]-a,2);return i},r=function(e,t){return e.concat(t)};return function(e){var i,n,l=[],o=0,p=0,c=0,s=t(e.reduce(r));for(i=0;i<e.length;i+=1)e[i].length>1&&l.push(e[i]);if((e=l).length<2||e[0].length<2||e[1].length<2)return NaN;for(i=0;i<e.length;i+=1)n=t(e[i]),p+=e[i].length*Math.pow(n-s,2),c+=a(e[i],n),o+=e[i].length;return p/=e.length-1,c/=o-e.length,p/c}}(),k.title=$('<h1 style="page-header">Parameter ANOVA</h1>'),k.figures=$("<div>",{class:"row"}),k.linear={},k.kinetic={},k.buttons=[],(r=function(e){var a,r,c=k[e];for(c.col=$("<div>",{class:"col col-xs-12 col-sm-6"}),c.title=$("<div>"),c.title.append($("<h3>"+v(e)+" Options</h3>")),r=$("<button>",{text:"Color By",class:"btn btn-default"}).click(function(){k.buttons.map(function(e){e.removeClass("active")}),k.buttons.map(function(e){e.text("Color By")}),$(this).addClass("active"),$(this).text("Colored By"),x=e,i.setColorFunc(n)}),c.title.append(r),k.buttons.push(r),c.equationTitle=$("<h4>Model Parameterized</h4>"),c.equation=$("<div>",{style:"min-height: 40px;display: table;"}).append($("<div>",{style:"display: table-cell;vertical-align:middle;"}).append(M.sToMathE(t[0][e].equation.mathType))),c.parameterTitle=$("<h4>Parameter Viewing</h4>"),c.parameterPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),c.backCorrTitle=$("<h4>Background Correction</h4>"),c.backCorrPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),c.backCorrSelected=$("<div>",{style:"margin-top:15px;",class:"text-center"}),c.fig=$("<div>"),c.f_val=$("<p>",{class:"text-center lead"}),c.col.append(c.title).append(c.equationTitle).append(c.equation).append(c.parameterTitle).append(c.parameterPicker).append(c.backCorrTitle).append(c.backCorrPicker).append(c.backCorrSelected).append(c.fig).append(c.f_val),a=0;a<y[e].params.length;a+=1)c.parameterPicker.append('<option value="'+a+'">'+y[e].params[a]+"</option>");c.parameterPicker.change(function(t){var a=t.target.value;y[e].param=a,d(m)}),c.backCorrPicker.append('<option value="0">Signal</option><option value="1">Background</option><option selected value="2">log_2(s/b)</option><option value="3">log_2(100(s - b + c_e))</option>').change(function(t){var a,r,i=t.target.value;switch(N[e]=i,i){case"0":c.backCorrSelected.html("signal"),l[e]=o;break;case"1":c.backCorrSelected.html("background"),l[e]=p;break;case"2":c.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})")),l[e]=s;break;case"3":c.backCorrSelected.html(M.sToMathE("log_2{100(signal-background+c_e)}")),l[e]=u}d(m),"3"===i&&(a="kinetic"===e?m.exposure:m.cycle,r=1-b[e][y[e].param][a],c.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+r.toFixed(4))))}),c.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})"))})("linear"),r("kinetic"),k.buttons[0].click(),k.figures.append(k.linear.col).append(k.kinetic.col),k.div.append(k.title).append(i.div).append(k.figures),i.change(d),i.setColorFunc(n),i.disableSample();var T=function(){var e={};return function(t,a,r){r||(r="Don't call this twice without a uniqueId"),e[r]&&clearTimeout(e[r]),e[r]=setTimeout(t,a)}}();window.addEventListener("resize",function(){T(function(){d(m)},500,"resize_reproduce")})},function(){var a=KINOME.addAnalysis("ANOVA");Promise.all(t).then(function(){e(a,KINOME.get({level:"^2"}))})}()}("undefined"!=typeof module&&module.exports?module.exports:window);