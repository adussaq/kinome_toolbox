!function(e){"use strict";e.enrich=function(t){var r,n,l,i,s,o,p,a,u,c,d,y,h,g,f,v,m,b,x,O,k;return g=function(){var t,o,p;r=function(e){var r,n,l,i,s,p,a,c,y=[],h=this;for(i=(e=k(e)).peptides,p=e.exposures,s=e.cycles,r=0;r<i.length;r+=1)for(n=0;n<s.length;n+=1)for(l=0;l<p.length;l+=1)a=u[s[n]][p[l]],c=d[i[r]].index,void 0!==a&&void 0!==c&&y.push({peptide:i[r],cycle:s[n],exposure:p[l],signal:h.signal[a][c],signal_valid:h.signal_valid[a][c],background:h.background[a][c],background_valid:h.background_valid[a][c],spot_row:d[i[r]].row,spot_column:d[i[r]].col,set:t(a,c,h),more:o(a,d[i[r]])});return y},o=function(e,t){return function(){return{peptide:v(t),image_index:e}}},i=function(e){var t,r,n,i,s,o,a,u,c=this;if(p(e)){if(t=e.value,r=e.valid,n=e.type,i=e.peptide,o=e.cycle,s=e.exposure,s=null===s?"Cycle Slope":s,o=null===o?"Post Wash":o,1!==(u=c.get({peptide:i,cycle:o,exposure:s})).length){for(c.signal.push(b(c[n][0].length)),c.signal_valid.push(b(c[n][0].length)),c.background.push(b(c[n][0].length)),c.background_valid.push(b(c[n][0].length)),c.cycles.push("string"==typeof o?null:o),c.exposures.push("string"==typeof s?null:s),a=0;a<c.run_data.length;a+=1)Array.isArray(c.run_data[a].value)&&c.run_data[a].value.length===c.cycles.length-1&&c.run_data[a].value.push(void 0);l(c),u=c.get({peptide:i,cycle:o,exposure:s})}return 0===u.length&&console.log({peptide:i,cycle:o,exposure:s}),u[0].set(n,t),u[0].set(n+"_valid",r),!0}return console.error("Failed to set, one or more parameters were missing or invalid."),!1},p=function(e){var t=!1;return e&&e.hasOwnProperty("value")&&e.hasOwnProperty("valid")&&e.hasOwnProperty("type")&&e.hasOwnProperty("peptide")&&e.hasOwnProperty("cycle")&&e.hasOwnProperty("exposure")&&(e.value*=1,e.valid*=1,e.cycle=null===e.cycle?null:"Post Wash"===e.cycle?null:1*e.cycle,e.exposure=null===e.exposure?null:"Cycle Slope"===e.exposure?null:1*e.exposure,isNaN(e.value)||isNaN(e.valid)||isNaN(e.cycle)||isNaN(e.exposure)||"string"!=typeof e.type||"string"!=typeof e.peptide||d.hasOwnProperty(e.peptide)&&e.type.match(/background|signal/)&&(t=!0)),t},t=function(e,t,r){return function(n,l){var i=this;n.match(/^(signal|background)(_valid)*$/)&&(r[n][e][t]=l,i[n]=l)}},n=function(e){var t;return(e=e||"").match(/peptide/i)?(t=v(c),t.more=x,t):e.match(/exposure/i)?v(y):e.match(/cycle/i)?v(a):(t={peptides:v(c),exposures:v(y),cycles:v(a)},t.peptides.more=x,t)},l=function(e){var t,r,n;for(a=[],u={},y=[],h={},c=[],d={},O(e),t=0;t<e.cycles.length;t+=1)null===(r=e.cycles[t])&&(r="Post Wash"),null===(n=e.exposures[t])&&(n="Cycle Slope"),u[r]=u[r]||[],u[r][n]=t,h[n]=1;a=Object.keys(u).map(m),y=Object.keys(h).map(m)},s=function(){var t,r,n,l=this;for(n=(r=JSON.parse(l.stringify())).cycles.length,delete r.cycles,delete r.exposures,delete r.background,delete r.background_valid,delete r.signal,delete r.signal_valid,r.linear={signal:[],background:[],cycles:[]},r.kinetic={signal:[],background:[],exposures:[]},r.level=r.level.replace(/^1/,"2"),console.log("delete this part once updated the data struct"),t=0;t<r.run_data.length;t+=1)if(r.run_data[t].key.match(/^cycle$/i)){n=r.run_data[t].value.length;break}for(t=0;t<r.run_data.length;t+=1)r.run_data[t].value.length===n&&(r.run_data.splice(t,1),t-=1);for(t=0;t<r.sample_data.length;t+=1)r.sample_data[t].value.length===n&&(r.sample_data.splice(t,1),t-=1);return e.enrich(r)}},f=function(){var e,t,s,o=["kinetic","linear"];i=function(e){var r,n,i,s,o,p=this;return t(e)?(r=e.value,n=e.peptide,s=e.cycle,i=e.exposure,i=null===i?"Cycle Slope":i,s=null===s?"Post Wash":s,1!==(o=p.get({peptide:n,type:e.fit,cycle:s,exposure:i})).length&&("kinetic"===e.fit?(p.kinetic.signal.push(b(p.peptides.length)),p.kinetic.background.push(b(p.peptides.length)),p.kinetic.exposures.push("string"==typeof i?null:i)):"linear"===e.fit&&(p.linear.signal.push(b(p.peptides.length)),p.linear.background.push(b(p.peptides.length)),p.linear.cycles.push("string"==typeof s?null:s)),l(p),o=p.get({peptide:n,type:e.fit,cycle:s,exposure:i})),0===o.length&&console.log({type:e.sig_type,peptide:n,cycle:s,exposure:i}),o[0].set(e.sig_type,r),!0):(console.error("Failed to set, one or more parameters were missing or invalid."),!1)},e=function(e,t,r,n){return function(l,i){(l=l.toLowerCase()).match(/^signal$|^background$/)?n[e][l][t][r]=i:console.error("failed to set, key invalid")}},s=function(e,t){return function(){return{peptide:v(t),fit_index:e}}},r=function(t){var r,n,l,i,p,a,c,y,g,f,m,b,x,O,P=this,_={},w=[];for(r=(t=k(t)).peptides,l=t.exposures,n=t.cycles,"string"==typeof(i=t.hasOwnProperty("type")?t.type:t.hasOwnProperty("types")?t.types:o)&&i.match(/kinetic|linear/i)?i=[i.toLowerCase()]:Array.isArray(i)&&i.map(function(e,t){return i[t]=i[t].toLowerCase(),e.match(/kinetic|linear/)?1:0}).reduce(function(e,t){return e*t})||(i=o),p=0;p<i.length;p+=1)for("kinetic"===i[p]?(y=l,f=h,g="exposure",m="cycle",b=n):(y=n,f=u,g="cycle",m="exposure",b=l),a=0;a<y.length;a+=1)for(c=0;c<r.length;c+=1)x=f[y[a]],O=d[r[c]].index,(_={peptide:r[c],type:i[p],signal:P[i[p]].signal[x][O],background:P[i[p]].background[x][O],spot_row:d[r[c]].row,spot_column:d[r[c]].col,set:e(i[p],x,O,P),more:s(x,d[r[c]])})[g]=y[a],_[m]=v(b),w.push(_);return w},l=function(e){var t,r,n;for(a=[],u={},y=[],h={},c=[],d={},O(e),t=0;t<e.linear.cycles.length;t+=1)null===(r=e.linear.cycles[t])&&(r="Post Wash"),u[r]=t;for(t=0;t<e.kinetic.exposures.length;t+=1)null===(n=e.kinetic.exposures[t])&&(n="Cycle Slope"),h[n]=t;a=Object.keys(u).map(m),y=Object.keys(h).map(m)},t=function(e){var t;return t=e.type.split(/_/),e.fit=t[1],e.sig_type=t[0],console.log(e,"need to write check append params function"),!0},n=function(e){var t;return(e=e||"").match(/peptide/i)?(t=v(c),t.more=x,t):e.match(/exposure/i)?v(y):e.match(/cycle/i)?v(a):e.match(/type/i)?v(o):(t={peptides:v(c),exposures:v(y),cycles:v(a),types:v(o)},t.peptides.more=x,t)}},x=function(){var e,t=[],r=this;for(e=0;e<r.length;e+=1)t.push(d[r[e]].full);return t},k=function(e){var t,r,n,l;if(e=e||{},t=e.hasOwnProperty("peptides")?e.peptides:e.hasOwnProperty("peptide")?e.peptide:c,r=e.hasOwnProperty("cycles")?e.cycles:e.hasOwnProperty("cycle")?e.cycle:void 0,n=e.hasOwnProperty("exposures")?e.exposures:e.hasOwnProperty("exposure")?e.exposure:void 0,void 0===r)for(r=v(a),l=0;l<r.length;l+=1)"Post Wash"===r[l]&&(r.splice(l,1),l-=1);if(void 0===n)for(n=v(y),l=0;l<n.length;l+=1)"Cycle Slope"===n[l]&&(n.splice(l,1),l-=1);for(t=Array.isArray(t)?t:[t],r=Array.isArray(r)?r:[r],n=Array.isArray(n)?n:[n],l=0;l<t.length;l+=1)d.hasOwnProperty(t[l])||t.splice(l,1);for(l=0;l<r.length;l+=1)u.hasOwnProperty(r[l])||r.splice(l,1);for(l=0;l<n.length;l+=1)h.hasOwnProperty(n[l])||n.splice(l,1);return{cycles:r,exposures:n,peptides:t}},b=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(void 0);return r},O=function(e){var t,r,n,l,i,s;for(t=0;t<e.peptides.length;t+=1){for(r=0;r<e.peptides[t].length;r+=1)"ID"===e.peptides[t][r].key&&(l=r),"spotRow"===e.peptides[t][r].key&&(n=r),"spotCol"===e.peptides[t][r].key&&(i=r);if("#REF"!==(s=e.peptides[t][l].value)){for(;d.hasOwnProperty(s);)s+="_2";c.push(s),d[s]={name:e.peptides[t][l].value,row:e.peptides[t][n].value,col:e.peptides[t][i].value,index:t,full:e.peptides[t]}}}},v=function(e){return JSON.parse(JSON.stringify(e))},o=function(){return e.enrich(v(this))},m=function(e){return e.match(/Post\ Wash|Cycle\ Slope/i)?e:1*e},p=function(){for(var e,t,r,n=this,l=[n];l.length>0;)for(t=l.shift(),e=Object.keys(t),r=0;r<e.length;r+=1)"object"==typeof t[e[r]]&&null!==t[e[r]]?l.push(t[e[r]]):t[e[r]]&&"number"==typeof t[e[r]]&&(t[e[r]]=1*t[e[r]].toPrecision(6));return JSON.stringify(n)},Array.isArray(t)?t=t.map(function(t){return e.enrich(t)}):!t.hasOwnProperty("get")&&t.level.match(/^1\.\d\.\d/)?(g(),Object.defineProperty(t,"clone",{value:o,enumerable:!1}),Object.defineProperty(t,"stringify",{value:p,enumerable:!1}),l(t),Object.defineProperty(t,"get",{value:r,enumerable:!1}),Object.defineProperty(t,"list",{value:n,enumerable:!1}),Object.defineProperty(t,"put",{value:i,enumerable:!1}),Object.defineProperty(t,"level_up",{value:s,enumerable:!1})):!t.hasOwnProperty("get")&&t.level.match(/^2\.\d\.\d/)&&(f(),Object.defineProperty(t,"clone",{value:o,enumerable:!1}),Object.defineProperty(t,"stringify",{value:p,enumerable:!1}),l(t),Object.defineProperty(t,"get",{value:r,enumerable:!1}),Object.defineProperty(t,"list",{value:n,enumerable:!1}),Object.defineProperty(t,"put",{value:i,enumerable:!1})),t}}("undefined"!=typeof module&&module.exports?module.exports:KINOME);