!function(e){"use strict";var t,n,r,a,o,u,i,c,l,s,f,d;u=[require("enrich_kinome")],t=function(e){var t,n,r=decodeURIComponent(location.href),a=[];for(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=(t=new RegExp("(?:[\\?&]"+e+'=")([^"]*)"',"g")).exec(r);n;)a.push(n[1]),n=t.exec(r);return a},l=function(e){var t,n,r,a=[];for(r=(n=new RegExp("data=\\*\\[([\\s\\S]+?)\\]\\*","g")).exec(e);r;)a.push(r[1]),r=n.exec(e);for(t=0;t<a.length;t+=1)a[t]=a[t].split(";");return a},a=function(e){return new Promise(function(t,n){$.ajax({url:e,dataType:"text",success:t,error:n})}).catch(function(t){KINOME.error(t,"Failed to load string: "+e+".")})},d=function(e){return new Promise(function(t,n){$.ajax({url:e,dataType:"text",success:function(e){$('<style type="text/css"></style>').html(e).appendTo("head"),t(!0)},error:n})}).catch(function(t){KINOME.error(t,"Failed to load style: "+e+".")})},c=function(e){var t,n,r,a,o,u,i=[];for(r='\\?find=\\{"name_id":(\\{"\\$in":\\[("'+(a="[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}")+'",*)+\\]\\}|"'+a+'")\\}',r=new RegExp(r,"i"),o=new RegExp(/[\s\S]+name\/*$/i),u={name:864e5,data:7776e6,other:18e5},n=function(e){return new Promise(function(t,n){var a=decodeURIComponent(e).replace(/\s/,"");KINOME.db.open.then(function(){var i=KINOME.db.db.where("url").equals(e);i.toArray().then(function(c){var l,s=!1,f=new Date;1===c.length&&c[0].time&&(l=c[0],a.match(r)?f-new Date(l.time)<u.data&&(s=!0):a.match(o)?f-new Date(l.time)<u.name&&(s=!0):f-new Date(l.time)<u.other&&(s=!0),s||i.delete()),s?t(c[0].text):$.ajax({url:e,dataType:"text",success:function(n){KINOME.db.db.put({text:n,url:e,time:String(new Date)}).then(function(){t(n)})},error:n})})})})},t=0;t<e.length;t+=1)i.push(n(e[t]));return Promise.all(i).then(function(t){var n,r,a,o=[];for(n=0;n<t.length;n+=1){for(a=JSON.parse(t[n]),Array.isArray(a)||(a=[a]),r=0;r<a.length;r+=1)Object.defineProperty(a[r],"data_origin_url",{enumerable:!1,configurable:!1,writable:!1,value:e[n]});a=KINOME.enrich(a),o=o.concat(a)}return o})},f=function(e){return function(){return require(e).catch(function(t){KINOME.error(t,"Failed to load script: "+e+".")})}},s=t("text"),i=t("style"),n=l(decodeURIComponent(location.href)),r=t("code"),e.params={},e.params.strings=[],e.params.data=[],e.params.script_urls=r,o=s.map(a).map(function(t,n){return t.then(function(t){e.params.strings[n]={value:t,url:s[n]}})}).concat(i.map(d)),Promise.all(u).then(function(){o=o.concat(n.map(c).map(function(t,r){return t.then(function(t){e.params.data[r]={value:t,url:n[r]}}).catch(function(e){KINOME.error(e,"Failed to load data: "+n[r])})})),Promise.all(o).then(function(){google.charts.setOnLoadCallback(function(){var e,t=Promise.resolve();for(e=0;e<r.length;e+=1)t=t.then(f(r[e]));t.then(f("webpage"))})}),e.loadData=function(t){return Array.isArray(t)||(t=[t]),c(t).then(function(n){return n=n.map(function(e){return KINOME.enrich(e)}),e.params.data.push({value:n,url:t}),n})}}),e.loadStrings=function(t){return Array.isArray(t)||(t=[t]),a(t).then(function(n){return e.params.strings.push({value:n,url:t}),n})},e.loadStyle=d}("undefined"!=typeof module&&module.exports?module.exports:KINOME);