!function(t){"use strict";var n,o,e,a={total:0,done:0};e=function(t){return function(t){if(!t.get||"function"!=typeof t.get)throw"Data object does not have get function attached. Use get_kinome.js to add this on.";var n,o,e,a,r,i,u,d,c;for(o=t.list("cycles"),e=t.list("exposures"),a=0;a<o.length;a+=1)for(r=0;r<e.length;r+=1){for(n=t.get({cycle:o[a],exposure:e[r]}),u={background:[],signal:[],name:[]},i=0;i<n.length;i+=1)d=n[i].spot_row-1,c=n[i].spot_col-1,u.background[d]=u.background[d]||[],u.signal[d]=u.signal[d]||[],u.name[d]=u.name[d]||[],u.name[d][c]=n[i].peptide,n[i].background_valid?(u.background[d][c]=n[i].background,n[i].signal_valid?u.signal[d][c]=n[i].signal:u.signal[d][c]=NaN):(u.background[d][c]=NaN,u.signal[d][c]=NaN);console.log(u)}return t}},o=function(t){var n,o,e,a,r,i,u,d=t.list("exposures");for(e=function(t){var n=1/0;return t.background_valid&&(n=Math.min(n,t.background)),t.signal_valid&&Math.min(n,t.signal),n},a=function(t,n){return"number"==typeof t&&"number"==typeof n?Math.min(t,n):"number"==typeof t?t:"number"==typeof n?n:1/0},i=t.list("cycles").reduce(a),n=0;n<d.length;n+=1)for(r=(u=t.get({cycle:i,exposure:d[n]})).map(e).reduce(a),u=t.get({exposure:d[n]}),o=0;o<u.length;o+=1)u[o].set("signal",u[o].signal-r),u[o].set("background",u[o].background-r);return t},n=function(t){return new Promise(function(n,r){t.data&&"object"==typeof t.data||r("Data object not added in. This will not work without it."),t.amd_ww&&"object"==typeof t.amd_ww||r("AMD_WW object not added in. This will not work without it."),t.worker&&"string"==typeof t.worker||r("String for worker url not added in. This will not work without it."),Array.isArray(t.data)||(t.data=[t.data]);var i;t.number_threads,console.log("\nStarting fits for background normalization.\n"),i=Promise.all(t.data.map(e())).catch(function(t){r({message:"Background normalization failed:",error:t})}),t.hasOwnProperty("update")&&"function"==typeof t.update&&t.update(a),i.then(function(t){t=t.map(o),n(t)}).catch(function(t){r(t)})})},t.normalize_background=n}("undefined"!=typeof module&&module.exports?module.exports:KINOME);