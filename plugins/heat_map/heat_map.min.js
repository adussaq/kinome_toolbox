var globalCharts=[];!function(){"use strict";var e,t,n,a=[require("bs_toggle-js"),require("img-picker"),require("gradient"),require("hcluster"),require("d3"),require("equation-picker"),require("bs_slider-js"),require("apex")];require("bs_toggle-css","style"),require("bs_slider-css"),n=function(){var e={};return function(t,n,a){a||(a="Don't call this twice without a uniqueId"),e[a]&&clearTimeout(e[a]),e[a]=setTimeout(t,n)}}(),e=function(e,a){var r,l,u,h,m={},g={};m.div=e,g.filter="none",g.filterVal=-1,m.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),m.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),u=function(e){var l,h,v,y,M,x;r=e,n(function(){var n,r,b,w;m&&m.heatMaps&&(m.linearHeatMap.empty(),m.kineticHeatMap.empty(),m.filterBar.empty()),i(a,g,e,m.filterBar,u),n=t(a,e.eq.linear.eval,"linear",e,g.filter,g.filterVal),r=t(a,e.eq.kinetic.eval,"kinetic",e,g.filter,g.filterVal),l=s(n),h=s(r),v=l.peptide.map(function(e){return n.peptide_list[e]}),y=h.peptide.map(function(e){return r.peptide_list[e]}),M=p(l.sample).map(function(e){return a[e].name}),x=p(h.sample).map(function(e){return a[e].name}),b=c(o(l.sample)),w=c(o(h.sample)),void 0!==m.dummyHeatMap&&($("<h3>Linear Heat Map</h3>").appendTo(m.linearHeatMap),d(b,a,m.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(m.linearHeatMap),f(b,m.dummyHeatMap,v,M,m.linearHeatMap),$("<h3>Kinetic Heat Map</h3>").appendTo(m.kineticHeatMap),d(w,a,m.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(m.kineticHeatMap),f(w,m.dummyHeatMap,y,x,m.kineticHeatMap))},100,"pepPicker")},m.figures=$("<div>",{class:"row"}),m.linear={},m.kinetic={},h=KINOME.imagePicker(a),l=KINOME.equationPicker(a,h,!0),h.div.appendTo(e),l.div.appendTo(e),l.change(u),h.disableSample(),m.figures.append(m.linear.col).append(m.kinetic.col),m.filterHolder=$("<div>",{class:"row"}),m.filterSwitches=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}).append('<h4 class="page-header">Choose Pre-Clustering Filter</h4>'),$("<div>",{class:"btn-group","data-toggle":"buttons"}).append($("<label>",{class:"btn btn-default btn-lg active",text:"None"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="none",g.filterVal=0,u(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"F-statistic"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="anova",g.filterVal=-1,u(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"Variance"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="variance",g.filterVal=-1,u(r)})).appendTo(m.filterSwitches),m.filterBar=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}),m.filterHolder.append(m.filterSwitches).append(m.filterBar),m.heatMaps=$("<div>",{class:"row"}),m.linearHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(m.heatMaps),m.kineticHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(m.heatMaps),m.dummyHeatMap=$("<div>",{class:"col-sm-6"}).appendTo($("<div>",{class:"row"}).appendTo($("<div>",{style:"height: 0px; visibility: hidden;",class:"container"}).appendTo("body"))),m.div.append(m.filterHolder).append(m.title).append(m.figures).append(m.heatMaps),u(r),window.addEventListener("resize",function(){n(function(){u(r)},500,"resize_reproduce")})},t=function(e,t,n,a,r,i,l){var o,p,s,c,u,d=[],f=[],m=[],g=-1,v=0,y=e.list("peptides"),M=[],x={type:n};for("linear"===n?x.cycle=a.cycle:"kinetic"===n&&(x.exposure=a.exposure),o=0;o<e.length;o+=1)for("anova"===r?(d[e[o].group]=d[e[o].group]||[],d[e[o].group].push([]),c=d[e[o].group][d[e[o].group].length-1]):(d[o]=[],c=d[o]),p=0;p<y.length;p+=1)x.peptides=y[p],c.push(t(e[o].get(x)[0]));if("anova"===r)for(m=[],s=0;s<d[0][0].length;s+=1){for(f=[],v=0,o=0;o<d.length;o+=1)for(f[o]=[],p=0;p<d[o].length;p+=1)m[v]=m[v]||[],f[o].push(d[o][p][s]),v+=1;if(u=h(f),M.push(u),u>i)for(g+=1,v=0,o=0;o<d.length;o+=1)for(p=0;p<d[o].length;p+=1)m[v][g]=d[o][p][s],v+=1}else if("variance"===r)for(p=0;p<d[0].length;p+=1){for(f=[],o=0;o<d.length;o+=1)m[o]=m[o]||[],f.push(d[o][p]);if(u=h.variance(f),M.push(u),u>i)for(g+=1,o=0;o<d.length;o+=1)m[o][g]=d[o][p]}else m=d;return l?M:(Object.defineProperty(m,"peptide_list",{configurable:!1,enumerable:!1,writable:!1,value:y}),m)};var r=function(e,t){return t-e},i=function(e,n,a,i,l){$('<h4 class="page-header">'+("anova"===n.filter?"Minimum Included F-statistic":"variance"===n.filter?"Minimum Included Variance":"Select a filter")+"</h4>").appendTo(i);var o,p,s,c,u=$('<div id="filter-slider" class="sliders"></div>').appendTo(i),d=$('<input type="text" />');s=function(e){return e},c=function(e){return e},d.appendTo(u),"anova"===n.filter||"variance"===n.filter?(o=(o=t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).concat(t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).sort(r),(p=o[Math.floor(.05*o.length)])<25&&(s=function(e){var t=e/25*p;return 1*(t=t.toPrecision(3))},c=function(e){return 25*e/p}),(!n.filterVal&&0!==n.filterVal||n.filterVal<0||n.filterVal>p)&&(n.filterVal=p/25*2),d.slider({value:c(n.filterVal),min:0,max:c(p),tooltip_position:"bottom",tooltip:"always",formatter:s}).on("slideStop",function(e){e.value!==c(n.filterVal)&&(n.filterVal=s(e.value),l(a))})):d.slider({value:1,min:0,max:2,tooltip_position:"bottom",tooltip:"always",enabled:!1,formatter:function(){return"N/A"}})},l=function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})},o=function(e){return e.left?o(e.left).concat(o(e.right)):[e.value]},p=function(e){return e.left?p(e.left).concat(p(e.right)):[e.key]},s=function(e){var t,n,a;return t=l(e),n=KINOME.hcluster(t,"euclidean","average"),a=l(o(n)),{sample:KINOME.hcluster(a,"euclidean","average"),peptide:p(n)}},c=function(e){var t,n,a=-1/0,r=1/0;for(t=0;t<e.length;t+=1)for(n=0;n<e[t].length;n+=1)Number.isNaN(e[t][n])||(a=Math.max(e[t][n],a),r=Math.min(e[t][n],r));for(t=0;t<e.length;t+=1)for(n=0;n<e[t].length;n+=1)e[t][n]=(e[t][n]-r)/(a-r);return e},u=function(e,t){return e.left?{children:[u(e.left,t),u(e.right,t)]}:{name:"G"+t[e.key].group,samp:"S"+e.key}},d=function(e,t,n){var a,r,i=$("<div>");a=s(e).sample,r=u(a,t);var l=n.width();a=d3.layout.cluster().size([l-10,110]);var o=d3.select(i[0]).append("svg").attr("width",l).attr("height",180).append("g").attr("transform","translate(5,40)"),p=a.nodes(r),c=(o.selectAll(".link").data(a.links(p)).enter().append("path").attr("class","link").attr("d",function(e,t){return"M"+e.source.x+","+e.source.y+"H"+e.target.x+"V"+e.target.y}),o.selectAll(".node").data(p).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}));return c.append("circle").attr("r",4.5),c.append("text").attr("dy",17).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.name}),c.append("text").attr("dy",30).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.samp}),$("head").append("<style>.node circle {fill: #fff;stroke: steelblue;  stroke-width: 1.5px;} .node {  font: 10px sans-serif;} .link {  fill: none;  stroke: #ccc;  stroke-width: 1.5px;}</style>"),i},f=function(e,t,n,a,r){var i,o,p,s=document.createElement("apexchart"),c=e[0].length,u=(e.length,c<80?320/c:4),d=l(e);p=[],console.log("the width",t.width());var f={chart:{height:c*u*2,width:t.width(),type:"heatmap"},legend:{show:!1},plotOptions:{heatmap:{shadeIntensity:1,colorScale:{}}},dataLabels:{enabled:!1},title:{text:""},yaxis:{labels:{show:!1}},xaxis:{labels:{show:!1}},series:[],tooltip:{x:{show:!0},y:{title:{formatter:function(e){return e}}}}};for(i=0;i<d.length;i+=1)for(f.series[i]={name:n[i],data:[]},o=0;o<d[i].length;o+=1)f.series[i].data.push({x:a[o],y:d[i][o]}),p.push(d[i][o]);p=p.sort(function(e,t){return e-t}),f.plotOptions.heatmap.colorScale.ranges=[{from:p[0],to:p[Math.floor(p.length/4)],name:"low",color:"#00A100"},{from:p[Math.ceil(p.length/4)],to:p[Math.floor(2*p.length/4)],name:"medium",color:"#128FD9"},{from:p[Math.ceil(2*p.length/4)],to:p[Math.floor(3*p.length/4)],name:"high",color:"#FFB200"},{from:p[Math.ceil(3*p.length/4)],to:p[p.length-1],name:"extreme",color:"#FF0000"}],r.append(s);return new ApexCharts(s,f).render(),$(s)},h=function(){var e=function(e,t){return e+t},t=function(t){return t.reduce(e)/t.length},n=function(e,n){var a,r=0;for(n=n||t(e),a=0;a<e.length;a+=1)r+=Math.pow(e[a]-n,2);return r},a=function(e,t){return e.concat(t)},r=function(e){var r,i,l=[],o=0,p=0,s=0,c=t(e.reduce(a));for(r=0;r<e.length;r+=1)e[r].length>1&&l.push(e[r]);if((e=l).length<2||e[0].length<2||e[1].length<2)return NaN;for(r=0;r<e.length;r+=1)i=t(e[r]),p+=e[r].length*Math.pow(i-c,2),s+=n(e[r],i),o+=e[r].length;return p/=e.length-1,s/=o-e.length,p/s};return r.variance=function(e){return n(e)/(e.length-1)},r}();Promise.all(a).then(function(){var t=KINOME.addAnalysis("Heat Map");e(t,KINOME.get({level:"^2"}))})}("undefined"!=typeof module&&module.exports?module.exports:window);