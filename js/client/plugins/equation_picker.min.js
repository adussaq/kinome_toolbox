!function(e){"use strict";var a;require("bs_toggle-js"),require("bs_toggle-css","style"),a=function(e,a,r){var t,n,i,o,l,c,p,s,u,m,d,g,k={},f={},h={linear:{},kinetic:{}},b={};if(function(){var a,n;a=function(e,a){return Math.log(e.signal.parameters[k[a].param]/e.background.parameters[k[a].param])/Math.log(2)},n=function(e,a,t){var n=c(a,t);return e.signal.parameters[k[a].param]-e.background.parameters[k[a].param]<n?r?0:NaN:Math.log(100*(e.signal.parameters[k[a].param]-e.background.parameters[k[a].param]-n+1))/Math.log(2)},c=function(a,r){var t,n,i,l,c,p=[];if(l="kinetic"===a?{type:a,exposure:i=void 0!==r?r:o.exposure}:{type:a,cycle:i=void 0!==r?r:o.cycle},h[a][k[a].param]=h[a][k[a].param]||{},void 0!==h[a][k[a].param][i])c=h[a][k[a].param][i];else{for(t=e.get(l),n=0;n<t.length;n+=1)p.push(t[n].signal.parameters[k[a].param]-t[n].background.parameters[k[a].param]);c=(p=p.sort(function(e,a){return e-a}))[Math.floor(p.length/20)-1],h[a][k[a].param][i]=c}return console.log(c),c},m=[["Signal","signal",function(e,a){return e.signal.parameters[k[a].param]},"signal"],["Background","background",function(e,a){return e.background.parameters[k[a].param]},"background"],["log_2(s / b)",M.sToMathE("log_2({signal}/{background})").outerHTML,a,"log_2({signal}/{background})"],["log_2(100(s - b + c_e))",M.sToMathE("log_2{100(signal-background+c_e)}").outerHTML,n,"log_2{100(signal-background+c_e)}"]],t={kinetic:a,linear:a}}(),g=function(){},"object"==typeof a&&"function"==typeof a.change)return console.warn("The equation selector plugin deletes the picker plugin change function. Any change function already set or color change function already set will be removed."),a.setColorFunc&&(s=a.setColorFunc,delete a.setColorFunc),u=a.change,delete a.change,k.linear={param:"0"},k.kinetic={param:"0"},i={linear:2,kinetic:2},p=function(e){var a=JSON.parse(JSON.stringify(e));o=e,k.sample&&k.sample.name===e.sample.name||(k.linear.params=e.sample.linear.equation.mathParams,k.kinetic.params=e.sample.kinetic.equation.mathParams,k.linear.equation_str=e.sample.linear.equation.mathType,k.kinetic.equation_str=e.sample.kinetic.equation.mathType,k.sample=e.sample,l("linear"),l("kinetic")),e.sample&&"function"==typeof e.sample.clone&&(a.sample=e.sample.clone()),a.eq={},a.eq.linear={eval:function(e,a){return t.linear(e,"linear",a)},parameter:k.linear.params[k.linear.param],equation_str:m[i.linear][3]},a.eq.kinetic={eval:function(e,a){return t.kinetic(e,"kinetic",a)},parameter:k.kinetic.params[k.kinetic.param],equation_str:m[i.kinetic][3]},console.log("here",t.linear),g(a)},d=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f.parameterSelector=$("<div>",{class:"row"}),f.linear={},f.kinetic={},f.linear.colHolder=$("<div>",{class:"col col-xs-12 col-sm-6"}),f.kinetic.colHolder=$("<div>",{class:"col col-xs-12 col-sm-6"}),f.linear.col=$("<div>"),f.kinetic.col=$("<div>"),f.linear.colHolder.append(f.linear.col),f.kinetic.colHolder.append(f.kinetic.col),f.buttons=[],l=function(e){var a,r,l,u,g=f[e];for(g.col.empty(),g.title=$("<div>"),g.title.append($("<h3>"+d(e)+" Options</h3>")),"function"==typeof s&&(r=$("<button>",{text:"Color By",class:"btn btn-default"}).click(function(){f.buttons.map(function(e){e.removeClass("active")}),f.buttons.map(function(e){e.text("Color By")}),$(this).addClass("active"),$(this).text("Colored By"),n!==e&&(n=e,p(o))}),g.title.append(r),f.buttons.push(r),n||r.click()),g.equationTitle=$("<h4>Model Parameterized</h4>"),g.equation=$("<div>",{style:"min-height: 40px;display: table;"}).append($("<div>",{style:"display: table-cell;vertical-align:middle;"}).append(M.sToMathE(k[e].equation_str))),g.parameterTitle=$("<h4>Parameter Viewing</h4>"),g.parameterPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),g.backCorrTitle=$("<h4>Background Correction</h4>"),g.backCorrPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),g.backCorrSelected=$("<div>",{style:"margin-top:15px;",class:"text-center"}),g.col.append(g.title).append(g.equationTitle).append(g.equation).append(g.parameterTitle).append(g.parameterPicker).append(g.backCorrTitle).append(g.backCorrPicker).append(g.backCorrSelected),("undefined"===k[e].param||1*k[e].param>k[e].params.length)&&(k[e].param=0),a=0;a<k[e].params.length;a+=1)l=$('<option value="'+a+'">'+k[e].params[a]+"</option>"),1*k[e].param===a&&l.attr("selected","true"),g.parameterPicker.append(l);for(g.parameterPicker.change(function(a){var r=a.target.value;k[e].param=r,p(o)}),a=0;a<m.length;a+=1)l=$('<option value="'+a+'">'+m[a][0]+"</option>"),1*i[e]===a&&l.attr("selected","true"),g.backCorrPicker.append(l);g.backCorrPicker.change(function(a){var r=a.target.value;i[e]=r,t[e]=m[r][2],g.backCorrSelected.html(m[r][1]),"3"===r&&(u=1-c(e),g.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+u.toFixed(4)))),p(o)}),g.backCorrSelected.html(m[i[e]][1]),"3"===i[e]&&(u=1-c(e),g.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+u.toFixed(4))))},f.parameterSelector.append(f.linear.colHolder).append(f.kinetic.colHolder),u(p),b.div=f.parameterSelector,b.col={kinetic:f.kinetic.col,linear:f.linear.col},b.change=function(e){"function"==typeof e&&(g=e),p(o)},"function"==typeof s&&(b.setColorFunc=function(e){s(function(a){return a.type=n,a.exec=function(e){return t[n](e,n)},a.parameter=k[n].params[k[n].param],e(a)})}),b;console.error("The equation selector requires a picker plugin object with a change function be passed in along with data.")},e.equationPicker=a}("undefined"!=typeof module&&module.exports?module.exports:KINOME);