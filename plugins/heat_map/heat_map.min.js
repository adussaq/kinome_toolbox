var globalCharts=[];!function(){"use strict";var e,t,n,a=[require("bs_toggle-js"),require("img-picker"),require("gradient"),require("hcluster"),require("d3"),require("equation-picker"),require("bs_slider-js"),require("apex")];require("bs_toggle-css","style"),require("bs_slider-css"),n=function(){var e={};return function(t,n,a){a||(a="Don't call this twice without a uniqueId"),e[a]&&clearTimeout(e[a]),e[a]=setTimeout(t,n)}}(),e=function(e,a){var r,l,u,h,g={},m={};g.div=e,m.filter="none",m.filterVal=-1,g.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),g.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),u=function(e){var l,h,v,y,M,x;r=e,n(function(){var n,r,b,w;g&&g.heatMaps&&(g.linearHeatMap.empty(),g.kineticHeatMap.empty(),g.filterBar.empty()),i(a,m,e,g.filterBar,u),console.log(e.eq.linear),console.log(e.eq.kinetic),console.log(e.eq.linear.eval),console.log(e.eq.kinetic.eval),n=t(a,e.eq.linear.eval,"linear",e,m.filter,m.filterVal),r=t(a,e.eq.kinetic.eval,"kinetic",e,m.filter,m.filterVal),l=s(n),h=s(r),v=l.peptide.map(function(e){return n.peptide_list[e]}),y=h.peptide.map(function(e){return r.peptide_list[e]}),M=p(l.sample).map(function(e){return a[e].name}),x=p(h.sample).map(function(e){return a[e].name}),b=c(o(l.sample)),w=c(o(h.sample)),void 0!==g.dummyHeatMap&&($("<h3>Linear Heat Map</h3>").appendTo(g.linearHeatMap),d(b,a,g.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(g.linearHeatMap),f(b,g.dummyHeatMap,v,M,g.linearHeatMap),$("<h3>Kinetic Heat Map</h3>").appendTo(g.kineticHeatMap),d(w,a,g.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(g.kineticHeatMap),f(w,g.dummyHeatMap,y,x,g.kineticHeatMap))},100,"pepPicker")},g.figures=$("<div>",{class:"row"}),g.linear={},g.kinetic={},h=KINOME.imagePicker(a),l=KINOME.equationPicker(a,h,!0),h.div.appendTo(e),l.div.appendTo(e),l.change(u),h.disableSample(),g.figures.append(g.linear.col).append(g.kinetic.col),g.filterHolder=$("<div>",{class:"row"}),g.filterSwitches=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}).append('<h4 class="page-header">Choose Pre-Clustering Filter</h4>'),$("<div>",{class:"btn-group","data-toggle":"buttons"}).append($("<label>",{class:"btn btn-default btn-lg active",text:"None"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){m.filter="none",m.filterVal=0,u(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"F-statistic"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){m.filter="anova",m.filterVal=-1,u(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"Variance"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){m.filter="variance",m.filterVal=-1,u(r)})).appendTo(g.filterSwitches),g.filterBar=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}),g.filterHolder.append(g.filterSwitches).append(g.filterBar),g.heatMaps=$("<div>",{class:"row"}),g.linearHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(g.heatMaps),g.kineticHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(g.heatMaps),g.dummyHeatMap=$("<div>",{class:"col-sm-6"}).appendTo($("<div>",{class:"row"}).appendTo($("<div>",{style:"height: 0px; visibility: hidden;",class:"container"}).appendTo("body"))),g.div.append(g.filterHolder).append(g.title).append(g.figures).append(g.heatMaps),u(r),window.addEventListener("resize",function(){n(function(){u(r)},500,"resize_reproduce")})},t=function(e,t,n,a,r,i,l){var o,p,s,c,u,d,f=[],g=[],m=[],v=-1,y=0,M=e.list("peptides"),x=[],b={type:n};for(d=M,"linear"===n?b.cycle=a.cycle:"kinetic"===n&&(b.exposure=a.exposure),o=0;o<e.length;o+=1)for("anova"===r?(f[e[o].group]=f[e[o].group]||[],f[e[o].group].push([]),c=f[e[o].group][f[e[o].group].length-1]):(f[o]=[],c=f[o]),p=0;p<M.length;p+=1)b.peptides=M[p],c.push(t(e[o].get(b)[0]));if("anova"===r)for(d=[],m=[],s=0;s<f[0][0].length;s+=1){for(g=[],y=0,o=0;o<f.length;o+=1)for(g[o]=[],p=0;p<f[o].length;p+=1)m[y]=m[y]||[],g[o].push(f[o][p][s]),y+=1;if(u=h(g),x.push(u),u>i){for(v+=1,y=0,o=0;o<f.length;o+=1)for(p=0;p<f[o].length;p+=1)m[y][v]=f[o][p][s],y+=1;d.push(M[s])}}else if("variance"===r)for(d=[],p=0;p<f[0].length;p+=1){for(g=[],o=0;o<f.length;o+=1)m[o]=m[o]||[],g.push(f[o][p]);if(u=h.variance(g),x.push(u),u>i){for(v+=1,o=0;o<f.length;o+=1)m[o][v]=f[o][p];d.push(M[p])}}else m=f;return l?x:(Object.defineProperty(m,"peptide_list",{configurable:!1,enumerable:!1,writable:!1,value:d}),m)};var r=function(e,t){return t-e},i=function(e,n,a,i,l){$('<h4 class="page-header">'+("anova"===n.filter?"Minimum Included F-statistic":"variance"===n.filter?"Minimum Included Variance":"Select a filter")+"</h4>").appendTo(i);var o,p,s,c,u=$('<div id="filter-slider" class="sliders"></div>').appendTo(i),d=$('<input type="text" />');s=function(e){return e},c=function(e){return e},d.appendTo(u),"anova"===n.filter||"variance"===n.filter?(o=(o=t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).concat(t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).sort(r),(p=o[Math.floor(.05*o.length)])<25&&(s=function(e){var t=e/25*p;return 1*(t=t.toPrecision(3))},c=function(e){return 25*e/p}),(!n.filterVal&&0!==n.filterVal||n.filterVal<0||n.filterVal>p)&&(n.filterVal=p/25*2),d.slider({value:c(n.filterVal),min:0,max:c(p),tooltip_position:"bottom",tooltip:"always",formatter:s}).on("slideStop",function(e){e.value!==c(n.filterVal)&&(n.filterVal=s(e.value),l(a))})):d.slider({value:1,min:0,max:2,tooltip_position:"bottom",tooltip:"always",enabled:!1,formatter:function(){return"N/A"}})},l=function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})},o=function(e){return e.left?o(e.left).concat(o(e.right)):[e.value]},p=function(e){return e.left?p(e.left).concat(p(e.right)):[e.key]},s=function(e){var t,n,a;return t=l(e),n=KINOME.hcluster(t,"euclidean","average"),a=l(o(n)),{sample:KINOME.hcluster(a,"euclidean","average"),peptide:p(n)}},c=function(e){return e},u=function(e,t){return e.left?{children:[u(e.left,t),u(e.right,t)]}:{name:"G"+t[e.key].group,samp:"S"+e.key}},d=function(e,t,n){var a,r,i=$("<div>");a=s(e).sample,r=u(a,t),console.log("",r,JSON.stringify(r));var l=n.width();a=d3.layout.cluster().size([l-10,110]);var o=d3.select(i[0]).append("svg").attr("width",l).attr("height",180).append("g").attr("transform","translate(5,40)"),p=a.nodes(r),c=(o.selectAll(".link").data(a.links(p)).enter().append("path").attr("class","link").attr("d",function(e,t){return"M"+e.source.x+","+e.source.y+"H"+e.target.x+"V"+e.target.y}),o.selectAll(".node").data(p).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}));return c.append("circle").attr("r",4.5),c.append("text").attr("dy",17).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.name}),c.append("text").attr("dy",30).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.samp}),$("head").append("<style>.node circle {fill: #fff;stroke: steelblue;  stroke-width: 1.5px;} .node {  font: 10px sans-serif;} .link {  fill: none;  stroke: #ccc;  stroke-width: 1.5px;}</style>"),i},f=function(e,t,n,a,r){var i,o,p,s=document.createElement("apexchart"),c=e[0].length,u=(e.length,c<80?320/c:4),d=l(e);p=[],console.log("the width",t.width());var f={chart:{height:c*u*2,width:t.width(),type:"heatmap"},legend:{show:!1},plotOptions:{heatmap:{shadeIntensity:1,colorScale:{}}},dataLabels:{enabled:!1},title:{text:""},yaxis:{labels:{show:!1}},xaxis:{labels:{show:!1}},series:[],tooltip:{x:{show:!0},y:{title:{formatter:function(e){return e}}}}};for(i=0;i<d.length;i+=1)for(f.series[i]={name:n[i],data:[]},o=0;o<d[i].length;o+=1)f.series[i].data.push({x:a[o],y:d[i][o]}),p.push(d[i][o]);p=p.sort(function(e,t){return e-t}),f.plotOptions.heatmap.colorScale.ranges=[{from:p[0],to:p[Math.floor(p.length/4)],name:"low",color:"#00A100"},{from:p[Math.ceil(p.length/4)],to:p[Math.floor(2*p.length/4)],name:"medium",color:"#128FD9"},{from:p[Math.ceil(2*p.length/4)],to:p[Math.floor(3*p.length/4)],name:"high",color:"#FFB200"},{from:p[Math.ceil(3*p.length/4)],to:p[p.length-1],name:"extreme",color:"#FF0000"}],r.append(s);return new ApexCharts(s,f).render(),$(s)},h=function(){var e=function(e,t){return e+t},t=function(t){return t.reduce(e)/t.length},n=function(e,n){var a,r=0;for(n=n||t(e),a=0;a<e.length;a+=1)r+=Math.pow(e[a]-n,2);return r},a=function(e,t){return e.concat(t)},r=function(e){var r,i,l=[],o=0,p=0,s=0,c=t(e.reduce(a));for(r=0;r<e.length;r+=1)e[r].length>1&&l.push(e[r]);if((e=l).length<2||e[0].length<2||e[1].length<2)return NaN;for(r=0;r<e.length;r+=1)i=t(e[r]),p+=e[r].length*Math.pow(i-c,2),s+=n(e[r],i),o+=e[r].length;return p/=e.length-1,s/=o-e.length,p/s};return r.variance=function(e){return n(e)/(e.length-1)},r}();Promise.all(a).then(function(){var t=KINOME.addAnalysis("Heat Map");e(t,KINOME.get({level:"^2"}))})}("undefined"!=typeof module&&module.exports?module.exports:window);