!function(){"use strict";var e,t,n,a=[require("bs_toggle-js"),require("img-picker"),require("gradient"),require("hcluster"),require("d3"),require("equation-picker"),require("bs_slider-js")];require("bs_toggle-css","style"),require("bs_slider-css"),n=function(){var e={};return function(t,n,a){a||(a="Don't call this twice without a uniqueId"),e[a]&&clearTimeout(e[a]),e[a]=setTimeout(t,n)}}(),e=function(e,a){var r,l,s,f,h={},g={};h.div=e,g.filter="none",g.filterVal=-1,h.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),h.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),s=function(e){r=e,n(function(){var n,r,l,f;h&&h.heatMaps&&(h.linearHeatMap.empty(),h.kineticHeatMap.empty(),h.filterBar.empty()),i(a,g,e,h.filterBar,s),n=t(a,e.eq.linear.eval,"linear",e,g.filter,g.filterVal),r=t(a,e.eq.kinetic.eval,"kinetic",e,g.filter,g.filterVal),l=c(o(p(n))),f=c(o(p(r))),void 0!==h.dummyHeatMap&&($("<h3>Linear Heat Map</h3>").appendTo(h.linearHeatMap),d(l,a,h.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(h.linearHeatMap),u(l,h.dummyHeatMap).css({width:"100%"}).appendTo(h.linearHeatMap),$("<h3>Kinetic Heat Map</h3>").appendTo(h.kineticHeatMap),d(f,a,h.dummyHeatMap).css({"margin-bottom":"10px"}).appendTo(h.kineticHeatMap),u(f,h.dummyHeatMap).css({width:"100%"}).appendTo(h.kineticHeatMap))},100,"pepPicker")},h.figures=$("<div>",{class:"row"}),h.linear={},h.kinetic={},f=KINOME.imagePicker(a),l=KINOME.equationPicker(a,f,!0),f.div.appendTo(e),l.div.appendTo(e),l.change(s),f.disableSample(),h.figures.append(h.linear.col).append(h.kinetic.col),h.filterHolder=$("<div>",{class:"row"}),h.filterSwitches=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}).append('<h4 class="page-header">Choose Pre-Clustering Filter</h4>'),$("<div>",{class:"btn-group","data-toggle":"buttons"}).append($("<label>",{class:"btn btn-default btn-lg active",text:"None"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="none",g.filterVal=0,s(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"F-statistic"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="anova",g.filterVal=-1,s(r)})).append($("<label>",{class:"btn btn-default btn-lg",text:"Variance"}).append($("<input>",{type:"radio",name:"options",autocomplete:"off"})).on("click",function(){g.filter="variance",g.filterVal=-1,s(r)})).appendTo(h.filterSwitches),h.filterBar=$("<div>",{class:"col-sm-6",style:"margin-top:10px"}),h.filterHolder.append(h.filterSwitches).append(h.filterBar),h.heatMaps=$("<div>",{class:"row"}),h.linearHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(h.heatMaps),h.kineticHeatMap=$("<div>",{class:"col-sm-6"}).appendTo(h.heatMaps),h.dummyHeatMap=$("<div>",{class:"col-sm-6"}).appendTo($("<div>",{class:"row"}).appendTo($("<div>",{style:"height: 0px; visibility: hidden;",class:"container"}).appendTo("body"))),h.div.append(h.filterHolder).append(h.title).append(h.figures).append(h.heatMaps),s(r),window.addEventListener("resize",function(){n(function(){s(r)},500,"resize_reproduce")})},t=function(e,t,n,a,r,i,l){var o,p,c,s,d,u=[],h=[],g=[],v=-1,m=0,y=e.list("peptides"),M=[],x={type:n};for("linear"===n?x.cycle=a.cycle:"kinetic"===n&&(x.exposure=a.exposure),o=0;o<e.length;o+=1)for("anova"===r?(u[e[o].group]=u[e[o].group]||[],u[e[o].group].push([]),s=u[e[o].group][u[e[o].group].length-1]):(u[o]=[],s=u[o]),p=0;p<y.length;p+=1)x.peptides=y[p],s.push(t(e[o].get(x)[0]));if("anova"===r)for(g=[],c=0;c<u[0][0].length;c+=1){for(h=[],m=0,o=0;o<u.length;o+=1)for(h[o]=[],p=0;p<u[o].length;p+=1)g[m]=g[m]||[],h[o].push(u[o][p][c]),m+=1;if(d=f(h),M.push(d),d>i)for(v+=1,m=0,o=0;o<u.length;o+=1)for(p=0;p<u[o].length;p+=1)g[m][v]=u[o][p][c],m+=1}else if("variance"===r)for(p=0;p<u[0].length;p+=1){for(h=[],o=0;o<u.length;o+=1)g[o]=g[o]||[],h.push(u[o][p]);if(d=f.variance(h),M.push(d),d>i)for(v+=1,o=0;o<u.length;o+=1)g[o][v]=u[o][p]}else g=u;return l?M:g};var r=function(e,t){return t-e},i=function(e,n,a,i,l){$('<h4 class="page-header">'+("anova"===n.filter?"Minimum Included F-statistic":"variance"===n.filter?"Minimum Included Variance":"Select a filter")+"</h4>").appendTo(i);var o,p,c,s,d=$('<div id="filter-slider" class="sliders"></div>').appendTo(i),u=$('<input type="text" />');c=function(e){return e},s=function(e){return e},u.appendTo(d),"anova"===n.filter||"variance"===n.filter?(o=(o=t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).concat(t(e,a.eq.linear.eval,"linear",a,n.filter,n.filterVal,!0)).sort(r),(p=o[Math.floor(.05*o.length)])<25&&(c=function(e){var t=e/25*p;return 1*(t=t.toPrecision(3))},s=function(e){return 25*e/p}),(!n.filterVal&&0!==n.filterVal||n.filterVal<0||n.filterVal>p)&&(n.filterVal=p/25*2),u.slider({value:s(n.filterVal),min:0,max:s(p),tooltip_position:"bottom",tooltip:"always",formatter:c}).on("slideStop",function(e){e.value!==s(n.filterVal)&&(n.filterVal=c(e.value),l(a))})):u.slider({value:1,min:0,max:2,tooltip_position:"bottom",tooltip:"always",enabled:!1,formatter:function(){return"N/A"}})},l=function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})},o=function(e){return e.left?o(e.left).concat(o(e.right)):[e.value]},p=function(e){var t,n,a;return t=l(e),n=KINOME.hcluster(t,"euclidean","average"),a=l(o(n)),KINOME.hcluster(a,"euclidean","average")},c=function(e){var t,n,a=-1/0,r=1/0;for(t=0;t<e.length;t+=1)for(n=0;n<e[t].length;n+=1)Number.isNaN(e[t][n])||(a=Math.max(e[t][n],a),r=Math.min(e[t][n],r));for(t=0;t<e.length;t+=1)for(n=0;n<e[t].length;n+=1)e[t][n]=(e[t][n]-r)/(a-r);return e},s=function(e,t){return e.left?{children:[s(e.left,t),s(e.right,t)]}:{name:"G"+t[e.key].group,samp:"S"+e.key}},d=function(e,t,n){var a,r,i=$("<div>");a=p(e),r=s(a,t);var l=n.width();a=d3.layout.cluster().size([l-10,110]);var o=d3.select(i[0]).append("svg").attr("width",l).attr("height",180).append("g").attr("transform","translate(5,40)"),c=a.nodes(r),d=(o.selectAll(".link").data(a.links(c)).enter().append("path").attr("class","link").attr("d",function(e,t){return"M"+e.source.x+","+e.source.y+"H"+e.target.x+"V"+e.target.y}),o.selectAll(".node").data(c).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}));return d.append("circle").attr("r",4.5),d.append("text").attr("dy",17).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.name}),d.append("text").attr("dy",30).attr("dx",-7).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.samp}),$("head").append("<style>.node circle {fill: #fff;stroke: steelblue;  stroke-width: 1.5px;} .node {  font: 10px sans-serif;} .link {  fill: none;  stroke: #ccc;  stroke-width: 1.5px;}</style>"),i},u=function(e,t){var n,a,r,i,l=document.createElement("canvas"),o=e[0].length,p=e.length,c=o<80?320/o:4;for(l.width=t.width(),l.height=o*c,i=l.width/p,r=l.getContext("2d"),n=0;n<e.length;n+=1)for(a=0;a<e[n].length;a+=1)r.fillStyle=KINOME.gradient.convert(e[n][a]),r.fillRect(n*i,a*c,i,c);return $(l)},f=function(){var e=function(e,t){return e+t},t=function(t){return t.reduce(e)/t.length},n=function(e,n){var a,r=0;for(n=n||t(e),a=0;a<e.length;a+=1)r+=Math.pow(e[a]-n,2);return r},a=function(e,t){return e.concat(t)},r=function(e){var r,i,l=[],o=0,p=0,c=0,s=t(e.reduce(a));for(r=0;r<e.length;r+=1)e[r].length>1&&l.push(e[r]);if((e=l).length<2||e[0].length<2||e[1].length<2)return NaN;for(r=0;r<e.length;r+=1)i=t(e[r]),p+=e[r].length*Math.pow(i-s,2),c+=n(e[r],i),o+=e[r].length;return p/=e.length-1,c/=o-e.length,p/c};return r.variance=function(e){return n(e)/(e.length-1)},r}();Promise.all(a).then(function(){var t=KINOME.addAnalysis("Heat Map");e(t,KINOME.get({level:"^2"}))})}("undefined"!=typeof module&&module.exports?module.exports:window);