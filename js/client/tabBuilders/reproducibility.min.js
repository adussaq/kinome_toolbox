!function(){"use strict";var e,t,a=[require("peptide_picker"),require("bs_toggle-js")];require("bs_toggle-css","style"),e=function(e,a){var r,i,n,o,l,p,s,c,u,d,g,h,m,f,v,b,k,y={},x={linear:{},kinetic:{}},N={},T=!1,w={linear:{},kinetic:{}},S={linear:2,kinetic:2};y.div=e,N.linear={param:0,params:a[0].linear.equation.mathParams},N.kinetic={param:0,params:a[0].kinetic.equation.mathParams},y.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),y.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),r=a.list("peptides"),o=function(e,t){return e.signal.parameters[N[t].param]},l=function(e,t){return e.background.parameters[N[t].param]},u=function(e,t){var r,i,n,o,l,p=[];if("kinetic"===t?(n=e.exposure,o={type:t,exposure:e.exposure}):(n=e.cycle,o={type:t,cycle:e.cycle}),x[t][N[t].param]=x[t][N[t].param]||{},void 0!==x[t][N[t].param][n])l=x[t][N[t].param][n];else{for(r=a.get(o),i=0;i<r.length;i+=1)p.push(r[i].signal.parameters[N[t].param]-r[i].background.parameters[N[t].param]);l=(p=p.sort(function(e,t){return e-t}))[Math.floor(p.length/20)-1],x[t][N[t].param][n]=l}return e.signal.parameters[N[t].param]-e.background.parameters[N[t].param]<l?NaN:Math.log(e.signal.parameters[N[t].param]-e.background.parameters[N[t].param]-l+1)/Math.log(2)},n={kinetic:c=function(e,t){return Math.log(e.signal.parameters[N[t].param]/e.background.parameters[N[t].param])/Math.log(2)},linear:c},d=function(e){var t,i,n,o,l={kinetic:[],linear:[]};if(o=function(t,r){l.kinetic.push(a.get({exposure:e.exposure,type:"kinetic",group:t,peptide:r})),l.linear.push(a.get({cycle:e.cycle,type:"linear",group:t,peptide:r}))},f=e,T?(y.selectedGroup.html("Displaying All Groups"),n=a.list("groups")):(y.selectedGroup.html("Displaying Group: "+e.sample.group),n=[e.sample.group]),e.peptide)for(i=0;i<n.length;i+=1)o(n[i],e.peptide);else for(t=0;t<r.length;t+=1)for(i=0;i<n.length;i+=1)o(n[i],r[t]);l.kinetic.length&&l.linear.length&&g(l,a.list("groups"))},b=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},m=function(e,t,a,r,i){return'<div style="min-width: 170px; padding:5px;">('+e.toFixed(2)+", "+t.toFixed(2)+'), <div>(<a target="_blank" href="'+a.lvl_1+'">'+a.name+'</a>, <a target="_blank" href="'+r.lvl_1+'">'+r.name+"</a>)</div>group: "+r.group+", <br />peptide: "+r.peptide+"<br />"+i+": "+r[i]+"</div>"};var _=function(e){return e};p=function(e,t,a,r){var i,o,l,p,s,c,u,d,g,f=[["X"]],v=["X"];for(i=0;i<r.length;i+=1)f[0].push("G"+i),f[0].push({type:"string",role:"tooltip",p:{html:!0}}),v.push(NaN),v.push("");for(v.push(NaN),f[0].push("one to one"),i=0;i<e[t].length;i+=1)for(o=0;o<e[t][i].length;o+=1)for(l=0;l<e[t][i].length;l+=1)o!==l&&(d=2*e[t][i][l].group+1,p=n[t](e[t][i][o],t),s=n[t](e[t][i][l],t),(g=v.map(_))[0]=p,g[d]=s,g[d+1]=m(p,s,e[t][i][o],e[t][i][l],a),f.push(g));return e[t][0][0]&&(u=.05*((c=h(e[t][0][0][a],t))[1]-c[0]),(g=v.map(_))[0]=c[0]-u,g[g.length-1]=c[0]-u,f.push(g),(g=v.map(_))[0]=c[1]+u,g[g.length-1]=c[1]+u,f.push(g)),f},v=function(e,a,r){var i=google.visualization.arrayToDataTable(e),n={};n[r.toString()]={color:"#e2431e",type:"line",enableInteractivity:!1};var o={title:"Reproducibility - "+b(a),titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"24"},hAxis:{title:N[a].params[N[a].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},vAxis:{title:N[a].params[N[a].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},legend:"none",tooltip:{isHtml:!0,trigger:"both"},seriesType:"scatter",series:n,height:y.width.width(),width:y.width.width()},l=new google.visualization.ComboChart(y[a].fig[0]);google.visualization.events.addListener(l,"ready",function(){$.each($("text"),function(e,t){var a=$(t).text();return a.match(/_|\^/)&&(a=(a=a.replace(/_([^{])|_\{([^}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="sub">$1$2</tspan>')).replace(/\^([^{])|\^\{([^}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="super">$1$2</tspan>'),$(t).html(a)),e})}),l.draw(i,o),y[a].corr.text("pearson's r = "+t(k(e)).toFixed(5))},k=function(e){var t,a,r=[];for(t=0;t<e.length;t+=1)for(r[t]=[],a=0;a<e[t].length&&r[t].length<2;a+=1)"number"!=typeof e[t][a]||Number.isNaN(e[t][a])||r[t].push(e[t][a]);return r.shift(),r},g=function(e,t){var a,r;(r=p(e,"kinetic","exposure",t)).length>1&&v(r,"kinetic",t.length),(a=p(e,"linear","cycle",t)).length>1&&v(a,"linear",t.length)},h=function(e,t){var r,i;if(r="kinetic"===t?{type:t,exposure:e}:{type:t,cycle:e},w[t]=w[t]||{},w[t][S[t]]=w[t][S[t]]||{},w[t][S[t]][N[t].param]=w[t][S[t]][N[t].param]||{},void 0!==w[t][S[t]][N[t].param][e])return w[t][S[t]][N[t].param][e];for(i=a.get(r).map(function(e){return n[t](e,t)}).sort(function(e,t){return e-t});Math.abs(i[0])>100*Math.abs(i[1]);)i.shift();for(;Math.abs(i[i.length-1])>100*Math.abs(i[i.length-2]);)i.pop();return w[t][S[t]][N[t].param][e]=[i[0],i[i.length-1]],w[t][S[t]][N[t].param][e]},y.title=$('<h1 style="page-header">Parameter Reproducibility</h1>'),y.groupHeading=$("<div>"),y.selectedGroup=$("<h2>",{class:"page-header"}),y.allTog=$('<input type="checkbox" data-on="All Groups" data-off="One Group" data-width="125" data-toggle="toggle">'),y.groupHeading.append(y.selectedGroup).append(y.allTog),y.allTog.bootstrapToggle().change(function(){T=$(this).prop("checked"),d(f)}),y.figures=$("<div>",{class:"row"}),y.linear={},y.kinetic={},(i=function(e){var t,r=y[e];for(r.col=$("<div>",{class:"col col-xs-12 col-sm-6"}),r.title=$("<h3>"+b(e)+" Options</h3>"),r.equationTitle=$("<h4>Model Parameterized</h4>"),r.equation=$("<div>",{style:"min-height: 40px;display: table;"}).append($("<div>",{style:"display: table-cell;vertical-align:middle;"}).append(M.sToMathE(a[0][e].equation.mathType))),r.parameterTitle=$("<h4>Parameter Viewing</h4>"),r.parameterPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),r.backCorrTitle=$("<h4>Background Correction</h4>"),r.backCorrPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),r.backCorrSelected=$("<div>",{style:"margin-top:15px;",class:"text-center"}),r.fig=$("<div>"),r.corr=$("<p>",{class:"text-center lead"}),r.col.append(r.title).append(r.equationTitle).append(r.equation).append(r.parameterTitle).append(r.parameterPicker).append(r.backCorrTitle).append(r.backCorrPicker).append(r.backCorrSelected).append(r.fig).append(r.corr),t=0;t<N[e].params.length;t+=1)r.parameterPicker.append('<option value="'+t+'">'+N[e].params[t]+"</option>");r.parameterPicker.change(function(t){var a=t.target.value;N[e].param=a,d(f)}),r.backCorrPicker.append('<option value="0">Signal</option><option value="1">Background</option><option selected value="2">log_2(s/b)</option><option value="3">log_2(100(s - b + c_e))</option>').change(function(t){var a,i,p=t.target.value;switch(S[e]=p,p){case"0":r.backCorrSelected.html("signal"),n[e]=o;break;case"1":r.backCorrSelected.html("background"),n[e]=l;break;case"2":r.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})")),n[e]=c;break;case"3":r.backCorrSelected.html(M.sToMathE("log_2{100(signal-background+c_e)}")),n[e]=u}d(f),"3"===p&&(a="kinetic"===e?f.exposure:f.cycle,i=1-x[e][N[e].param][a],r.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+i.toFixed(4))))}),r.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})"))})("linear"),i("kinetic"),y.figures.append(y.linear.col).append(y.kinetic.col),s=KINOME.peptidePicker(a),y.div.append(y.title).append(s.div).append(y.groupHeading).append(y.figures),setTimeout(function(){s.change(d)},2e3);var C=function(){var e={};return function(t,a,r){r||(r="Don't call this twice without a uniqueId"),e[r]&&clearTimeout(e[r]),e[r]=setTimeout(t,a)}}();window.addEventListener("resize",function(){C(function(){d(f)},500,"resize_reproduce")})},t=function(){var e,t,a,r;return e=function(e,t){return[e[0]+t[0],e[1]+t[1]]},t=function(e){return[e[0]*e[0],e[1]*e[1]]},a=function(e){return e[0]*e[1]},r=function(e,t){return e+t},function(i){var n=0,o=[];for(n=0;n<i.length;n+=1)i[n][0]=parseFloat(i[n][0]),i[n][1]=parseFloat(i[n][1]),"number"==typeof i[n][0]&&!Number.isNaN(i[n][0])&&"number"==typeof i[n][1]&&!Number.isNaN(i[n][1])&&isFinite(i[n][0])&&isFinite(i[n][1])&&o.push([i[n][0],i[n][1]]);if(!o.length)return 0;var l=o.reduce(e),p=o.map(t).reduce(e),s=o.map(a).reduce(r),c=o.length,u=s-l[0]*l[1]/c,d=Math.sqrt((p[0]-l[0]*l[0]/c)*(p[1]-l[1]*l[1]/c));return 0===d?0:u/d}}(),function(){var t=KINOME.addAnalysis("Reproducibility");Promise.all(a).then(function(){e(t,KINOME.get({level:"^2"}))})}()}("undefined"!=typeof module&&module.exports?module.exports:window);