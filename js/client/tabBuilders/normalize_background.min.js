!function(e){"use strict";var t,a,n,i,o,l,r,s,c,p={};"./js/lib/normalize_background_worker.min.js",r=[require("amd_ww"),require("gradient"),require("enrich_kinome"),require("normalize_background"),require("bs_slider-js")],require("bs_slider-css"),l=function(e,t){t.append("<div>This script normalizes all of the level 1.0.1 image backgrounds utilizing multiple linear regression. Once you start the fitting, a loading bar will appear and you will be able to investigate before and after of the normalization on an image by image basis.<div>"),$("<button>",{style:"margin: 15px;",class:"btn btn-primary btn-lg",text:"Begin Correction."}).click(function(a){$(this).unbind("click"),s(e,t)(a)}).appendTo($("<div>",{class:"text-center"}).appendTo(t))},s=function(e,t){return function(a){a.preventDefault();var n;n=function(e){t.append("<div>",{text:e});var a=$("<div>",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:"width: 0%"}).appendTo($('<div class="progress"></div>').appendTo(t));return function(e){var t,n;t=setInterval(function(){e.done===e.total&&clearInterval(t),n=e.done/e.total*100,n=n.toFixed(2),a.attr("aria-valuenow",n),a.attr("style","width: "+n+"%"),a.text(n+"%")},100)}},KINOME.normalize_background({data:e,amd_ww:amd_ww,worker:"./js/lib/normalize_background_worker.min.js",number_threads:4,update:n("Normalizing")}).then(function(a){c(e,KINOME.enrich(a),t)})}},t=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},i=function(e,a,n,i,o){var l,r,s;for(r=0;r<a.length;r+=1)if(a[r]===n){n=r;break}return s=$("<h2>"+t(o)+"</h2>"),l=$('<input type="text" />'),e.append(s).append($("<div>",{class:"center-block",style:"width:90%"}).append(l)),l.slider({value:n,min:0,max:a.length-1,tooltip_position:"bottom",tooltip:"always",formatter:function(e){return a[e]}}).on("slideStop",function(e){i(o,a[e.value])}),l},n=function(e,t,n){var i,o,l,r=p.width.width(),s=document.createElement("canvas"),c=0,d=0;for(o=0;o<e.length;o+=1)c=Math.max(e[o].spot_row,c),d=Math.max(e[o].spot_col,d);for(s.width=.8*r,s.height=r*c/d*.8,l=r/d*.8,i=s.getContext("2d"),o=0;o<e.length;o+=1)i.fillStyle=a((e[o].background-t)/(n-t)),i.fillRect(l*(e[o].spot_col-1),l*(e[o].spot_row-1),l,l);return $(s).css({width:"70%","margin-top":"15px"})},c=function(e,t,a){var l,r,s,c,d,u=e.list("names"),m={};for(p.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),p.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),s=function(){p.cyclePicker.empty(),p.exposurePicker.empty(),i(p.cyclePicker,m.sample[0].list("cycle"),m.cycle,c,"cycle"),i(p.exposurePicker,m.sample[0].list("exposure"),m.exposure,c,"exposure"),d()},o=function(e){var t,a=[["signal","background",{type:"string",role:"tooltip"}]];for(t=0;t<e.length;t+=1)a.push([e[t].signal,e[t].background,"("+e[t].signal.toFixed(1)+", "+e[t].background.toFixed(1)+")\nPeptide: "+e[t].peptide]);return a},d=function(){var a=m.sample[0].get(m),i=m.sample[1].get(m),l={exposure:m.exposure};p.canvasIn.empty(),p.canvasOut.empty(),p.gplot1.empty(),p.gplot2.empty();var s=-1/0,c=1/0;return"Post Wash"===m.cycle&&(l.cycle="Post Wash"),e.get(l).map(function(e){s=Math.max(e.background,s),c=Math.min(e.background,c)}),t.get(l).map(function(e){s=Math.max(e.background,s),c=Math.min(e.background,c)}),n(a,c,s).appendTo(p.canvasIn),n(i,c,s).appendTo(p.canvasOut),r(o(a),"In",p.gplot1[0]),r(o(i),"Out",p.gplot2[0]),[a,i]},r=function(e,t,a){var n=google.visualization.arrayToDataTable(e),i={title:"Signal v Background "+t,titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"24"},hAxis:{title:"Signal",titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},vAxis:{title:"Background",titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},legend:"none",seriesType:"scatter",series:{4:{color:"#e2431e",type:"line",enableInteractivity:!1}},height:p.width.width(),width:p.width.width()},o=new google.visualization.ComboChart(a);google.visualization.events.addListener(o,"ready",function(){$.each($("text"),function(e,t){var a=$(t).text();return a.match(/_|\^/)&&(a=(a=a.replace(/_([^\{])|_\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="sub">$1$2</tspan>')).replace(/\^([^\{])|\^\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="super">$1$2</tspan>'),$(t).html(a)),e})}),o.draw(n,i)},c=function(a,n){m[a]!==n&&(m[a]=n,"name"===a?(m.sample=[e.get({name:n,get_samples:!0})[0],t.get({name:n,get_samples:!0})[0]],s()):d())},m={exposure:50,cycle:"Post Wash"},p.img_picker=$("<div>",{class:"row"}),p.samp_picker=$("<div>"),$("<h2>Sample</h2>").appendTo(p.samp_picker),p.samp_dropdown=$("<select>",{class:"form-control"}).appendTo(p.samp_picker),l=0;l<u.length;l+=1)p.samp_dropdown.append('<option value="'+u[l]+'" >'+u[l]+"</option>");return p.samp_picker.appendTo($("<div>",{class:"col-sm-4 col-xs-12"}).appendTo(p.img_picker)),p.samp_dropdown.change(function(){c("name",$(this).val())}),p.cyclePicker=$("<div>",{class:"col-sm-4 col-xs-12"}).appendTo(p.img_picker),p.exposurePicker=$("<div>",{class:"col-sm-4 col-xs-12"}).appendTo(p.img_picker),p.img_picker.appendTo(a),p.titleIn=$("<h2>",{style:"margin-top:40px;",class:"page-header",text:"Background In"}),p.titleOut=$("<h2>",{style:"margin-top:40px;",class:"page-header",text:"Background Out"}),p.canvasIn=$("<div>",{class:"center-block text-center"}),p.canvasOut=$("<div>",{class:"center-block text-center"}),p.gplot1=$("<div>"),p.gplot2=$("<div>"),$("<div>",{class:"row"}).append($("<div>",{class:"col-xs-12 col-sm-6"}).append(p.titleIn).append(p.canvasIn).append(p.gplot1)).append($("<div>",{class:"col-xs-12 col-sm-6"}).append(p.titleOut).append(p.canvasOut).append(p.gplot2)).appendTo(a),c("name",e[0].name),[e,t]},Promise.all(r).then(function(){var e=KINOME.get({level:"1.0.1"});a=KINOME.gradient.convert,e.length&&l(e,KINOME.addAnalysis("Normalize Background"))})}("undefined"!=typeof module&&module.exports?module.exports:KINOME);