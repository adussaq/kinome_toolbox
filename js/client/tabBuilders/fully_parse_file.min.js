!function(){"use strict";require("./js/lib/parse_kinome_and_background.js"),require("./js/lib/enrich_kinome.js"),require("./js/lib/quality_filtration.js"),require("./js/lib/background_normalization.js"),require("amd_ww"),require("./js/lib/parameterize_curves.js"),require("level_1_display"),require("set_up_table");var e="./models/cyclingEq_3p_hyperbolic.jseq",n="./js/lib/fitCurvesWorker.js",t=KINOME.addAnalysis("Parse Local Files");require(function(){var a,r,o,i,l,s,c,u,d,p,h,m,g,f={};d=function(e){return function(n){n.preventDefault();var t=$(this);return f[e]=n.target.files[0],n.target.files.length&&(t.addClass("disabled"),t.find("input").remove(),t.unbind("click")),!(!f.signal||!f.background)&&p()}},o=function(e){return console.log(e),e},a=function(e){return new Promise(function(n){setTimeout(function(){n(e)},1e3)})},m=function(e){t.append('<p class="text-center">'+e+"</p>");var n=$("<div>",{class:"progress-bar",role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100",style:"width: 0%"}).appendTo($('<div class="progress"></div>').appendTo(t));return function(e){var t,a;t=setInterval(function(){e.done===e.total&&clearInterval(t),a=e.done/e.total*100,a=a.toFixed(2),n.attr("aria-valuenow",a),n.attr("style","width: "+a+"%"),n.text(a+"%")},100)}},g=function(t){return KINOME.filter({data:t["1.0.0"],amd_ww:amd_ww,equation:e,worker:n,number_threads:4,linearUpdate:m("Finding outliers: Linear Fits"),kineticUpdate:m("Finding outliers: Kinetic Fits")}).then(function(e){return t["1.0.1"]=KINOME.enrich(e),t})},h=function(e){return new Promise(function(n,t){var a=new FileReader;a.onload=function(e){n(e.target.result)},a.onerror=t,a.readAsText(e)})},c=function(e){return console.log(e),e.name=KINOME.enrich(e.name),e["1.0.0"]=KINOME.enrich(e["1.0.0"]),e},u=function(e){var n=KINOME.parse({signal:{data:e[0],filename:f.signal.name},background:{data:e[1],filename:f.background.name}});return r=f.signal.name,t.append('<p class="text-center">Files Parsed!</p>'),n};var v=!1,b=["name","1.0.0","1.0.1","1.1.2","2.0.1","2.1.2"],w=!1,y=!1;i=function(t){return KINOME.parameterize({data:t["1.0.1"],amd_ww:amd_ww,equation:e,worker:n,number_threads:4,update:m("Building lvl 2.0.1")}).then(function(e){return t["2.0.1"]=KINOME.enrich(e),t})},l=function(t){return KINOME.parameterize({data:t["1.1.2"],amd_ww:amd_ww,equation:e,worker:n,number_threads:4,update:m("Building lvl 2.1.2")}).then(function(e){return t["2.1.2"]=KINOME.enrich(e),t})},s=function(e){console.log(e);return KINOME.normalize_background({data:e["1.0.1"],amd_ww:amd_ww,worker:"./js/lib/normalize_background_worker.js",number_threads:4,update:m("Normalizing Background")}).then(function(n){return e["1.1.2"]=KINOME.enrich(n),console.log(e),e})},p=function(){var n=[h(f.signal),h(f.background),require(e).then(function(n){e=n.replace(/\/\/[^\n]*/g,"").replace(/\s+/g," ")})];return t.append('<p class="text-center">Parsing Files, this can take a while depending on the file sizes.</p>'),Promise.all(n).then(a).then(u).then(a).then(c).then(a).then(g).then(a).then(s).then(a).then(i).then(o).then(a).then(l).then(a).then(o).then(function(e){t.append("<h1>Level 1.0.1 Data</h1>"),t.append('<p class="text-center">We are showing you your level 1.0.1 data to make sure that it looks correct. Once you verify that it does please go the the bottom of the page to save the data locally and download it for your own purposes.</p>'),KINOME.levelOneDisplay(e["1.0.1"]).appendTo(t);var n=$('<div class="row text-center"></div>').appendTo(t);$("<button>",{class:"btn btn-lg btn-primary",html:"<span>Download JSON Files</span>"}).click(function(){!function(e){var n,t;if(!v)for(v=!0,n=r.replace(/\.[\S\s]{0,4}$/,""),t=0;t<b.length;t+=1)save(e[b[t]].stringify(),n+"_"+b[t]+".json")}(e)}).appendTo($('<div class="col col-sm-4 col-xs-12"></div>').appendTo(n)),$("<button>",{class:"btn btn-lg btn-primary",html:"<span>Download MongoDB Files</span>"}).click(function(){!function(e){var n,t,a;if(a=function(e){return e.stringify()},!w)for(w=!0,n=r.replace(/\.[\S\s]{0,4}$/,""),t=0;t<b.length;t+=1)save(e[b[t]].map(a).join("\n"),n+"_"+b[t]+".mdb")}(e)}).appendTo($('<div class="col col-sm-4 col-xs-12"></div>').appendTo(n)),$("<button>",{class:"btn btn-lg btn-primary",html:"<span>Save Data To Local Storage</span>"}).click(function(){!function(e){var n,t,a,r,o=Promise.resolve();if(r=function(e,n){return function(){return require.store(e,JSON.parse(n.stringify()))}},KINOME.alert("Saving to local storage, do not exit this page or refresh. This can take quite a while depending on the number of samples provided."),!y){for(y=!0,n=0;n<b.length;n+=1)for(a="name"===b[n]?"name":"lvl_"+b[n],t=0;t<e[b[n]].length;t+=1)o=o.then(r(a,e[b[n]][t]));console.log(o),o.then(function(){return console.log("saved...."),KINOME.loadData("local://name")}).then(function(){console.log("loaded again...."),KINOME.updateMainTable(KINOME.get({level:"name"}),"name"),KINOME.alert("Saving is complete, feel free to navigate as normal.")})}}(e)}).appendTo($('<div class="col col-sm-4 col-xs-12"></div>').appendTo(n))})},t.append('<p class="text-center">This tool allows you to process your own bionavigator files. It will parse them locally and store them in the semi-persistant IndexDB. As long as this is a private computer this will protect your data and will no data will be shared. This data will disappear if you clear your cache, and only exists on this computuer. Even though we provide this tool, we recommend you download parsed data and create a database with it, or ask us to add your data to our public repository. (See About) Keep scrolling down to see the results. As more is done more will show up. At the end there will be buttons that will allow you to download or store your data locally.</p>');var _=$("<span>",{class:"btn btn-primary btn-lg btn-file",html:'Select Median Signal File<input class="computerFile" type="file">'}).appendTo($('<div class="text-center" style="margin:15px;"></div>').appendTo(t)),k=$("<span>",{class:"btn btn-primary btn-lg btn-file",html:'Select Median Background File<input class="computerFile" type="file">'}).appendTo($('<div class="text-center" style="margin:15px;"></div>').appendTo(t));_.change(d("signal")),k.change(d("background"))})}();