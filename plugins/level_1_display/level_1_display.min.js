!function(e){"use strict";require("peptide_picker"),require("fit");e.levelOneDisplay=function(e){var i={};i.dummyWidth=$("<div>"),i.dummyWidth.appendTo($("<div>",{class:"col-sm-6"}).appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height: 0; visibility: hidden"}).appendTo("body"))));var a=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t=function(){var e={};return function(i,a,t){t||(t="Don't call this twice without a uniqueId"),e[t]&&clearTimeout(e[t]),e[t]=setTimeout(i,a)}}(),n=function(){i.chartLocations.cycleSignal.empty(),i.chartLocations.exposureSignal.empty(),i.chartLocations.cycleBackground.empty(),i.chartLocations.exposureBackground.empty()},o=function(e,i,t,n){var o,d,r=$('<div style="min-width: 170px; padding: 5px;"></div>');return e[t+"_valid"]?(o="Valid "+a(t),d="green"):(o="Invalid "+a(t),d="red"),r.append('<span style="color: '+d+'">'+o+"</span>"),r.append('<div style="padding-bottom: 0; margin-bottom: 0"><strong>Point</strong>: '+e[i]+", "+e[t]+"</div>"),r.append('<div style="padding-bottom: 0; margin-bottom: 0"><strong>Sample</strong>: '+e.name+"</div>"),r.append('<div style="padding-bottom: 0; margin-bottom: 0"><strong>Peptide</strong>: '+e.peptide+"</div>"),void 0!==e.image&&r.append('<div style="padding-bottom: 0; margin-bottom: 0"><strong>Image</strong>: <a href="./image/?img='+encodeURIComponent('"'+e.image+'"')+'" target="_blank">'+e.image+"</a></div>"),r[0].outerHTML},d=function(e,t,d,r){var l;l=function(e,i){var a={};return"kinetic"===i&&e.kinetic&&e.kinetic.peptide?(a.data=e.sample.get(e.kinetic),a.input="cycle"):"linear"===i&&e.linear&&e.linear.peptide?(a.data=e.sample.get(e.linear),a.input="exposure"):n(),a}(e,d),KINOME.fit(l.data,d,r).then(function(e){t.empty(),function(e,i){var a,t,n,o=$("<div></div>");return $("<h3>Model</h3>").appendTo(o),a=$('<div class="row"></div>').appendTo(o),t=$('<div class="col-md-6"></div>').appendTo(a),$("<h4>Equation</h4>").appendTo(t),$("<div>").append($(KINOME.formatEquation(e.displayEq(i.parameters)))).css({"padding-left":"20px"}).appendTo(t),n=$('<div class="col-md-6"></div>').appendTo(a),$("<h4>R Squared</h4>").appendTo(n),$("<div>").append(i.R2.toFixed(5)).css({"padding-left":"20px"}).appendTo(n),i.WWtest&&($("<h4>Wald-Wolfowitz p-value</h4>").appendTo(t),$("<div>").append(i.WWtest[0].toFixed(5)).css({"padding-left":"20px"}).appendTo(t)),o}(e.equation,e[r]).appendTo(t),function(e,t,n,d){var r,l,p;return e=function(e,i,t,n,d){var r,l;(r=new google.visualization.DataTable).addColumn("number",a(i)+"s"),r.addColumn("number","Valid "+a(t)),r.addColumn({type:"string",role:"tooltip",p:{html:!0}}),r.addColumn("number","Invalid "+a(t)),r.addColumn({type:"string",role:"tooltip",p:{html:!0}}),r.addColumn("number","Fit");for(var p=0;p<e.length;p++)e[p][t+"_valid"]?(l=o(e[p],i,t),r.addRow([e[p][i],e[p][t],l,NaN,"",n.func([e[p][i]],d)])):(l=o(e[p],i,t),r.addRow([e[p][i],NaN,"",e[p][t],l,n.func([e[p][i]],d)]));return r}(e,t,n,d.equation,d[n].parameters),l=a(t)+" vs. "+a(n),p={title:l,titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"24"},hAxis:{title:a(t),titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"14"}},vAxis:{title:a(n),titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"14"}},tooltip:{isHtml:!0,trigger:"both"},seriesType:"scatter",series:{2:{type:"line",enableInteractivity:!1}},legend:"none",height:.65*i.dummyWidth.width(),width:i.dummyWidth.width()},r=$("<div></div>"),new google.visualization.ComboChart(r[0]).draw(e,p),r}(l.data,l.input,r,e).appendTo(t)})};i.superDiv=$("<div>"),i.peptidePicker=$("<div></div>").appendTo(i.superDiv),i.row=$('<div class="row"></div>').appendTo(i.superDiv),i.signalCol=$('<div id="signal-col" class="col-sm-6"></div>').appendTo(i.row),i.backgroundCol=$('<div id="background-col" class="col-sm-6"></div>').appendTo(i.row),i.chartLocations={},i.chartLocations.cycleSignal=$('<div class="graph"></div>').appendTo(i.signalCol),i.chartLocations.exposureSignal=$('<div class="graph"></div>').appendTo(i.signalCol),i.chartLocations.cycleBackground=$('<div class="graph"></div>').appendTo(i.backgroundCol),i.chartLocations.exposureBackground=$('<div class="graph"></div>').appendTo(i.backgroundCol);var r=KINOME.peptidePicker(e);r.change(function(e){null!==e.peptide?(d(e,i.chartLocations.cycleSignal,"kinetic","signal"),d(e,i.chartLocations.cycleBackground,"kinetic","background"),d(e,i.chartLocations.exposureSignal,"linear","signal"),d(e,i.chartLocations.exposureBackground,"linear","background"),$(window).resize(function(a){t(function(){d(e,i.chartLocations.cycleSignal,"kinetic","signal"),d(e,i.chartLocations.cycleBackground,"kinetic","background"),d(e,i.chartLocations.exposureSignal,"linear","signal"),d(e,i.chartLocations.exposureBackground,"linear","background")},500,"bleh bleh bleh <-- my unique ID")})):n()}),r.setColorFunc(function(e,i){for(var a,t=-1/0,n=[],o=0;o<e.length;o++)t=(a=Math.log(e[o].signal/e[o].background)/Math.log(2))>t?a:t,n.push(a);for(o=0;o<n.length;o++)n[o]=n[o]/t;return Promise.resolve(n)}),i.peptidePicker.append(r.div);return i.superDiv.setColorFunc=r.setColorFunc,i.superDiv}}(KINOME);