!function(){"use strict";var e,t=[require("peptide_picker"),require("bs_toggle-js")];require("bs_toggle-css","style"),e=function(e,t){var a,n,r,i,l,o,p,c,s,u,d,g,h,m,f,v,b,k,y={},x={linear:{},kinetic:{}},_={},w="linear",N={linear:2,kinetic:2};y.div=e,_.linear={param:0,params:t[0].linear.equation.mathParams},_.kinetic={param:0,params:t[0].kinetic.equation.mathParams},r=KINOME.peptidePicker(t),y.width=$("<div>",{class:"col col-sm-6 col-xs-12"}),y.width.appendTo($("<div>",{class:"row"}).appendTo($("<div>",{class:"container",style:"height:0px;visibility: hidden;"}).appendTo("body"))),o=function(e,t){return e.signal.parameters[_[t].param]},p=function(e,t){return e.background.parameters[_[t].param]},u=function(e,a){var n,r,i,l,o,p=[];if("kinetic"===a?(i=e.exposure,l={type:a,exposure:e.exposure}):(i=e.cycle,l={type:a,cycle:e.cycle}),x[a][_[a].param]=x[a][_[a].param]||{},void 0!==x[a][_[a].param][i])o=x[a][_[a].param][i];else{for(n=t.get(l),r=0;r<n.length;r+=1)p.push(n[r].signal.parameters[_[a].param]-n[r].background.parameters[_[a].param]);o=(p=p.sort(function(e,t){return e-t}))[Math.floor(p.length/20)-1],x[a][_[a].param][i]=o}return e.signal.parameters[_[a].param]-e.background.parameters[_[a].param]<o?NaN:Math.log(e.signal.parameters[_[a].param]-e.background.parameters[_[a].param]-o+1)/Math.log(2)},l={kinetic:s=function(e,t){return Math.log(e.signal.parameters[_[t].param]/e.background.parameters[_[t].param])/Math.log(2)},linear:s},d=function(e){var a,n,r,i={kinetic:[],linear:[]};if(r=function(a,n,r){i.kinetic[n]=i.kinetic[n]||[],i.linear[n]=i.linear[n]||[],i.kinetic[n]=i.kinetic[n].concat(t.get({exposure:e.exposure,type:"kinetic",group:r,peptide:a})),i.linear[n]=i.linear[n].concat(t.get({cycle:e.cycle,type:"linear",group:r,peptide:a}))},m=e,n=t.list("groups"),e.peptide)for(a=0;a<n.length;a+=1)r(e.peptide,a,n[a]);else y.kinetic.fig.empty(),y.kinetic.f_val.empty(),y.linear.fig.empty(),y.linear.f_val.empty();i.kinetic.length&&i.linear.length&&g(i,n)},v=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},h=function(e,t,a,n){return'<div style="min-width: 170px; padding:5px;">(Group: '+e+", Value:"+t.toFixed(2)+'), <div>(<a target="_blank" href="'+a.lvl_1+'">'+a.name+"</a>, peptide: "+a.peptide+"<br />"+n+": "+a[n]+"</div>"};var C=function(e){return e};c=function(e,t,a,n){var r,i,o,p,c,s,u=[["Group Number"]],d=["X"],g=[];for(r=0;r<n.length;r+=1)u[0].push("G"+r),u[0].push({type:"string",role:"tooltip",p:{html:!0}}),d.push(NaN),d.push(""),g.push([]);for(r=0;r<e[t].length;r+=1)for(i=0;i<e[t][r].length;i+=1)c=2*e[t][r][i].group+1,o=e[t][r][i].group+(.3*Math.random()-.15),p=l[t](e[t][r][i],t),g[e[t][r][i].group].push(p),(s=d.map(C))[0]=o,s[c]=p,s[c+1]=h(e[t][r][i].group,p,e[t][r][i],a),u.push(s);return{chart:u,stats:g}},k=function(e,n){var r,i,o,p,c,s,u,d,g,h,m=t.list("groups"),f=[];for(u=t.list("peptides"),i=0;i<u.length;i+=1){for(d=[],c={},r=0;r<m.length;r+=1){for(g=t.get({peptide:u[i],exposure:e.exposure,cycle:e.cycle,type:n,group:m[r]}),h=[],c[r]={},o=0;o<g.length;o+=1)p=l[n](g[o],n),c[r][g[o].name]=p,h.push(p);d.push(h)}s=a(d),f.push([u[i],s,c])}return f},i=function(e,n){var r,i,o,p,c,s,u,d=t.list("groups"),g=1/0,h=-1/0,m=[];for(i=0;i<e[w].length;i+=1){for(c=[],r=0;r<d.length;r+=1){for(s=t.get({peptide:e[w][i].peptide,exposure:n.exposure,cycle:n.cycle,type:w,group:d[r]}),u=[],o=0;o<s.length;o+=1)u.push(l[w](s[o],w));c.push(u)}p=a(c),Number.isNaN(p)||(g=Math.min(g,p),h=Math.max(h,p)),m.push(p)}return Promise.resolve(m.map(function(e){return Number.isNaN(e)?0:(e-g)/(h-g)}))},f=function(e,t){var n=google.visualization.arrayToDataTable(e.chart),r={title:"Reproducibility - "+v(t),titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',bold:!1,fontSize:"24"},hAxis:{title:_[t].params[_[t].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},vAxis:{title:_[t].params[_[t].param],titleTextStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"20",bold:!1},textStyle:{fontName:'"Helvetica Neue", Helvetica, Arial, sans-serif',fontSize:"14"}},legend:"none",tooltip:{isHtml:!0,trigger:"both"},seriesType:"scatter",height:.68*y.width.width(),width:y.width.width()},i=new google.visualization.ComboChart(y[t].fig[0]);google.visualization.events.addListener(i,"ready",function(){$.each($("text"),function(e,t){var a=$(t).text();return a.match(/_|\^/)&&(a=(a=a.replace(/_([^\{])|_\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="sub">$1$2</tspan>')).replace(/\^([^\{])|\^\{([^\}]*)\}/g,'<tspan style="font-size: smaller;" baseline-shift="super">$1$2</tspan>'),$(t).html(a)),e})}),i.draw(n,r),y[t].f_val.text("f-test = "+a(e.stats).toFixed(5))},g=function(e,t){var a,n;(n=c(e,"kinetic","exposure",t)).chart.length>1&&(f(n,"kinetic"),b(y.kinetic.download_data,"kinetic",k,m)),(a=c(e,"linear","cycle",t)).chart.length>1&&(f(a,"linear"),b(y.linear.download_data,"linear",k,m))},a=function(){var e=function(e,t){return e+t},t=function(t){return t.reduce(e)/t.length},a=function(e,a){var n,r=0;for(a=a||t(e),n=0;n<e.length;n+=1)r+=Math.pow(e[n]-a,2);return r},n=function(e,t){return e.concat(t)};return function(e){var r,i,l=[],o=0,p=0,c=0,s=t(e.reduce(n));for(r=0;r<e.length;r+=1)e[r].length>1&&l.push(e[r]);if((e=l).length<2||e[0].length<2||e[1].length<2)return NaN;for(r=0;r<e.length;r+=1)i=t(e[r]),p+=e[r].length*Math.pow(i-s,2),c+=a(e[r],i),o+=e[r].length;return p/=e.length-1,c/=o-e.length,p/c}}(),y.title=$('<h1 style="page-header">Parameter ANOVA</h1>'),y.figures=$("<div>",{class:"row"}),y.linear={},y.kinetic={},y.buttons=[],b=function(e,t,a,n){var r;return e.empty(),(r=$("<button>",{class:"btn btn-default btn-large center-block"}).on("click",function(){var e,r,i,l,o,p,c,s=a(n,t),u=[];for(p=Object.keys(s[0][2]),c=[],l=0;l<p.length;l+=1)c[l]=Object.keys(s[0][2][p[l]]);for(u.push(["Peptide","F-statistic"]),l=0;l<p.length;l+=1)for(o=0;o<c[l].length;o+=1)u[0].push("Group "+p[l]+": "+c[l][o]);for(u[0]=u[0].join("\t"),i=0;i<s.length;i+=1){for(u[i+1]=[s[i][0],s[i][1]],l=0;l<p.length;l+=1)for(o=0;o<c[l].length;o+=1)u[i+1].push(s[i][2][p[l]][c[l][o]]);u[i+1]=u[i+1].join("\t")}e="linear"===t?n.exposure+"ms":"cycle_"+n.cycle,r=new Date,save(u.join("\n"),"f_stats_"+t+"_"+e+"_"+r.toLocaleDateString().replace(/[^\w\d]+/g,"_")+"_"+r.toLocaleTimeString().replace(/[^\w\d]+/g,"_")+".txt")})).html("Download All "+v(t)+" Data and F-statistics"),e.append(r),e},(n=function(e){var a,n,c=y[e];for(c.col=$("<div>",{class:"col col-xs-12 col-sm-6"}),c.title=$("<div>"),c.title.append($("<h3>"+v(e)+" Options</h3>")),n=$("<button>",{text:"Color By",class:"btn btn-default"}).click(function(){y.buttons.map(function(e){e.removeClass("active")}),y.buttons.map(function(e){e.text("Color By")}),$(this).addClass("active"),$(this).text("Colored By"),w=e,r.setColorFunc(i)}),c.title.append(n),y.buttons.push(n),c.equationTitle=$("<h4>Model Parameterized</h4>"),c.equation=$("<div>",{style:"min-height: 40px;display: table;"}).append($("<div>",{style:"display: table-cell;vertical-align:middle;"}).append(M.sToMathE(t[0][e].equation.mathType))),c.parameterTitle=$("<h4>Parameter Viewing</h4>"),c.parameterPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),c.backCorrTitle=$("<h4>Background Correction</h4>"),c.backCorrPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),c.backCorrSelected=$("<div>",{style:"margin-top:15px;",class:"text-center"}),c.fig=$("<div>"),c.download_data=$("<div>",{style:"padding: 20px"}),c.f_val=$("<p>",{class:"text-center lead"}),c.col.append(c.title).append(c.equationTitle).append(c.equation).append(c.parameterTitle).append(c.parameterPicker).append(c.backCorrTitle).append(c.backCorrPicker).append(c.backCorrSelected).append(c.fig).append(c.f_val).append(c.download_data),a=0;a<_[e].params.length;a+=1)c.parameterPicker.append('<option value="'+a+'">'+_[e].params[a]+"</option>");c.parameterPicker.change(function(t){var a=t.target.value;_[e].param=a,d(m)}),c.backCorrPicker.append('<option value="0">Signal</option><option value="1">Background</option><option selected value="2">log_2(s/b)</option><option value="3">log_2(100(s - b + c_e))</option>').change(function(t){var a,n,r=t.target.value;switch(N[e]=r,r){case"0":c.backCorrSelected.html("signal"),l[e]=o;break;case"1":c.backCorrSelected.html("background"),l[e]=p;break;case"2":c.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})")),l[e]=s;break;case"3":c.backCorrSelected.html(M.sToMathE("log_2{100(signal-background+c_e)}")),l[e]=u}d(m),"3"===r&&(a="kinetic"===e?m.exposure:m.cycle,n=1-x[e][_[e].param][a],c.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+n.toFixed(4))))}),c.backCorrSelected.html(M.sToMathE("log_2({signal}/{background})"))})("linear"),n("kinetic"),y.buttons[0].click(),y.figures.append(y.linear.col).append(y.kinetic.col),y.div.append(y.title).append(r.div).append(y.figures),r.change(d),r.setColorFunc(i),r.disableSample();var T=function(){var e={};return function(t,a,n){n||(n="Don't call this twice without a uniqueId"),e[n]&&clearTimeout(e[n]),e[n]=setTimeout(t,a)}}();window.addEventListener("resize",function(){T(function(){d(m)},500,"resize_reproduce")})},function(){var a=KINOME.addAnalysis("ANOVA");Promise.all(t).then(function(){e(a,KINOME.get({level:"^2"}))})}()}("undefined"!=typeof module&&module.exports?module.exports:window);