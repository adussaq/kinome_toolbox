!function(){"use strict";var fmincon,determineRunningConditions,runsTest,linearReg,errorList,robustFit;fmincon=function(){var r,n,t,e;return t=function(t,i,o,a,u){var s,c,f,l,h,g,p,b,m,v,y;for(l={step:a.map(function(r){return r/100}),maxItt:500,minPer:1e-6},f=1/0,m=JSON.parse(JSON.stringify(a)),c=0;c<l.maxItt;c+=1){for(h in m)m.hasOwnProperty(h)&&(m[h]+=l.step[h],r(o,t,i,m)<r(o,t,i,a)?(a[h]=m[h],l.step[h]*=1.2):(m[h]=a[h],l.step[h]*=-.5));if(c%3==0){if(p=r(o,t,i,a),Math.abs(1-p/f)<l.minPer)break;f=p}}if(g=n(i),b=r(o,t,i,a),s=1-Math.min(b/g,1),!t[0]);return 1===t[0].length&&(v=linearReg(t,i),(y=e(function(r){return v.parameters[0]*r[0]+v.parameters[1]},o,a,t,i)).push(Math.log10((1-v.R2)/(1-s)))),{errors:errorList(o,t,i,a),curvature:y,parameters:a,totalSqrErrors:b,R2:s,linearR2:v.R2,linear:v,WWtest:runsTest(o,t,i,a)}},r=function(r,n,t,e){var i,o=0,a=n.length;for(i=0;i<a;i+=1)o+=Math.pow(r(n[i],e)-t[i],2);return o},errorList=function(r,n,t,e){var i,o=[],a=n.length;for(i=0;i<a;i+=1)o.push({error:r(n[i],e)-t[i],y:t[i]});return o},n=function(r){var n,t,e,i;for(t=0,n=0,e=r.length,i=0;i<e;i+=1)n+=r[i];for(n/=e,i=0;i<e;i+=1)t+=Math.pow(r[i]-n,2);return t},e=function(r,n,t,e,i){var o,a,u,s,c,f,l,h;for(o=0,a=0,u=e.length,f=0;f<u;f+=1)s=n(e[f],t),c=r(e[f]),o+=Math.pow(s-c,2),l=Math.pow(s-i[f],2),a+=((h=Math.pow(c-i[f],2))-l)/Math.max(l,h);return o/=u,a/=u,[o,a,runsTest(r,e,i,[])]},t}(),linearReg=function(){var r;return r=function(r,n){var t,e,i,o,a,u=0,s=0,c=0,f=0,l=0,h=r.length;for(t=0;t<h;t+=1)o=1===r[t].length?r[t][0]:r[t].length>1?0:r[t],f+=n[t],c+=o,s+=o*o,l+=n[t]*n[t],u+=o*n[t];return e=(u-c*f/h)/(s-c*c/h),i=(f-e*c)/h,a=Math.pow(u-c*f/h,2)/(s-c*c/h)/(l-f*f/h),{parameters:[e,i],R2:a,errors:errorList(function(r,n){return r[0]*n[0]+n[1]},r,n,[e,i])}},function(n,t){var e,i,o=r(n,t),a=[];for(o.R2=1-(n.length-1)/(n.length-2)*(1-a.R2),a.push(JSON.parse(JSON.stringify(o))),e=0;e<n.length;e+=1)(i=r(n.slice(0,e).concat(n.slice(e+1,n.length)),t.slice(0,e).concat(t.slice(e+1,t.length)))).R2=1-(n.length-1)/(n.length-2)*(1-i.R2),i.R2>o.R2&&(e,o=i),a.push(JSON.parse(JSON.stringify(i)));return o},r}(),robustFit=function(r,n,t,e,i,o,a,u){var s,c,f,l,h,g,p,b,m=[],v=0;for(o?o.length:1,f=function(r){return 1-(1-r.R2)*(r.errors.length-1)/(r.errors.length-r.parameters.length-1)},(l=n(t,e,i,o,a,u)).remove=-1,v+=f(l),m.push([f(l),l,-1]),s=0;s<t.length;s+=1)h=JSON.parse(JSON.stringify(t)),g=JSON.parse(JSON.stringify(e)),h.splice(s,1),g.splice(s,1),p=n(h,g,i,o,a,u),v+=f(p),m.push([f(p),p,s]);return m=m.sort(function(r,n){return r[0]-n[0]}),b=m.pop(),v-=b[0],v/=m.length,c=m.map(function(r){return Math.pow(v-r[0],2)}).reduce(function(r,n){return r+n}),v+2*Math.sqrt(c/m.length)<b[0]&&((l=b[1]).remove=b[2]),l.robust=r,l},determineRunningConditions=function(object){var i,X,xIni,yIni,length,equationObj,linear=!1,retObj,robust=!1;for(X=object.x,xIni=[],yIni=[],length=X.length,"linear"===object.equation.string?linear=!0:equationObj=eval("equationObj="+object.equation.string),i=0;i<length;i+=1)object.valid[i]&&(xIni.push([X[i]]),yIni.push(object.y[i]));return 0===X.length&&X.push([]),object.equation.robust&&(robust=object.equation.robust),retObj=linear?{robust:robust,X:xIni,y:yIni,linear:linear}:{robust:robust,params:equationObj.setInitial(xIni,yIni),X:xIni,y:yIni,func:equationObj.func,linear:linear,aoc:object.aoc}},self.onmessage=function(r){var n,t;n=(t=determineRunningConditions(r.data.model)).linear?t.robust?robustFit(t.robust,linearReg,t.X,t.y):linearReg(t.X,t.y):t.robust?robustFit(t.robust,fmincon,t.X,t.y,t.func,t.params,r.data,t.aoc):fmincon(t.X,t.y,t.func,t.params,r.data,t.aoc),self.postMessage([r.data.origin,n])},runsTest=function(){var r,n,t,e,i,o;return r=function(r,n,e,i){var o,a,u,s,c,f,l;for(s=[1,0],c=[1,0],f=0,l=n.length,u=e[0]-r(n[0],i),o=1;o<l;o+=1)(a=e[o]-r(n[o],i))*u<=0&&(c[f=(f+1)%2]+=1),s[f]+=1,u=a;return[t(s[0],s[1],c[0]+c[1]),c[0]+c[1]]},t=function(r,n,t){var e=t%2;return t<2?0:e?(o(r-1,(t-1)/2)*o(n-1,(t-3)/2)+o(r-1,(t-3)/2)*o(n-1,(t-1)/2))/o(r+n,r):2*o(r-1,t/2-1)*o(n-1,t/2-1)/o(r+n,r)},o=function(r,t){var o;return t>r?o=0:n.hasOwnProperty(r)?n[r].hasOwnProperty(t)&&(o=n[r][t]):o=i(r,Math.max(r-t,t))/e(Math.min(r-t,t)),o},e=function(r){var n,t=1;if(r>=1)for(n=r;n>1;n-=1)t*=n;return t},i=function(r,n){var t,e=1;for(t=r;t>n;t+=-1)e*=t;return e},n={1:{0:1,1:1},2:{0:1,1:2,2:1},3:{0:1,1:3,2:3,3:1},4:{0:1,1:4,2:6,3:4,4:1},5:{0:1,1:5,2:10,3:10,4:5,5:1},6:{0:1,1:6,2:15,3:20,4:15,5:6,6:1},7:{0:1,1:7,2:21,3:35,4:35,5:21,6:7,7:1},8:{0:1,1:8,2:28,3:56,4:70,5:56,6:28,7:8,8:1},9:{0:1,1:9,2:36,3:84,4:126,5:126,6:84,7:36,8:9,9:1},10:{0:1,1:10,2:45,3:120,4:210,5:252,6:210,7:120,8:45,9:10,10:1},11:{0:1,1:11,2:55,3:165,4:330,5:462,6:462,7:330,8:165,9:55,10:11,11:1},12:{0:1,1:12,2:66,3:220,4:495,5:792,6:924,7:792,8:495,9:220,10:66,11:12,12:1},13:{0:1,1:13,2:78,3:286,4:715,5:1287,6:1716,7:1716,8:1287,9:715,10:286,11:78,12:13,13:1}},r}()}();