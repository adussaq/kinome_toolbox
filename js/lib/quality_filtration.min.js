!function(e){"use strict";var t,n,o,r,i,a={done:0,total:0},u={done:0,total:0};56.9441,.8,163.4145573051634,o=function(e,t,n){var o=0,r={x:[],y:[],valid:[],equation:{string:n}},i={x:[],y:[],valid:[],equation:{string:n}};for(o=0;o<e.length;o+=1)i.x.push(e[o][t]),i.y.push(e[o].signal),i.valid.push(e[o].signal_valid),r.x.push(e[o][t]),r.y.push(e[o].background),r.valid.push(e[o].background_valid);return{signal:i,background:r}},n=function(e){return function(t){if(!t.get||"function"!=typeof t.get)throw"Data object does not have get function attached. Use get_kinome.js to add this on.";var n,r,i,u,s,l=[];(t=t.clone()).level="1.0.1",s=function(n){var r,i,u,l=!1;if(n[1].robust&&n[1].remove>=0&&t.get(n[0])[n[1].remove].set(n[0].type+"_valid",0),!n[1].robust||n[1].remove>=0){for(r=0;!l&&r<n[1].errors.length;r+=1)Math.pow(n[1].errors[r].error,2)>56.9441&&(l=!0);if(l&&n[1].errors.length>3)return i=t.get(n[0]),u=o(i,"exposure","linear"),u[n[0].type].equation.robust=!0,e.submit({model:u[n[0].type],origin:n[0]}).then(s)}return a.done+=1,n[0].exposure=null,n[0].value=n[1].parameters[0],n[0].valid=n[1].R2>.8?1:0,null!==n[0].cycle&&t.append(n[0]),!0},n=t.list("cycle"),r=t.list("peptides");var d,c;for(d=0;d<r.length;d+=1)for(c=0;c<n.length;c+=1)(i=t.get({peptide:r[d],cycle:n[c]})).length>1&&(u=o(i,"exposure","linear"),a.total+=2,l.push(e.submit({model:u.signal,origin:{peptide:r[d],cycle:n[c],type:"signal"}}).then(s)),l.push(e.submit({model:u.background,origin:{peptide:r[d],cycle:n[c],type:"background"}}).then(s)));return Promise.all(l).then(function(){return t}).catch(function(e){console.log("something failed...",e)})}},r=function(e,t){return function(n){if(!n.get||"function"!=typeof n.get)throw"Data object does not have get function attached. Use get_kinome.js to add this on.";var r,i,a,s,l,d,c=[],p=[],g=0;n=n.clone(),d=function(e){var t,n;for(t=0;void 0===n&&t<e.y.length;t+=1)e.valid[t]&&(n=e.y[t]);for(n-=5,t=0;t<e.y.length;t+=1)e.y[t]-=n;return e},l=function(r){var i,a,s,p=!1;if(r[1].robust||r[1].errors.map(function(e){c.push(e.error+"\t"+e.y)}),r[1].robust&&r[1].remove>=0&&n.get(r[0])[r[1].remove].set(r[0].type+"_valid",0),!r[1].robust||r[1].remove>=0&&r[1].robust<4){for(i=0;!p&&i<r[1].errors.length;i+=1)Math.pow(r[1].errors[i].error,2)>163.4145573051634&&(p=!0);if(p&&r[1].errors.length>8)return r[1].robust||(g+=1),a=n.get(r[0]),s=o(a,"cycle",t),s[r[0].type].equation.robust=r[1].robust||0,s[r[0].type].equation.robust+=1,e.submit({model:d(s[r[0].type]),origin:r[0]}).then(l)}return u.done+=1,!0},r=n.list("exposure"),i=n.list("peptides");var f,h;for(f=0;f<i.length;f+=1)for(h=0;h<r.length;h+=1)(a=n.get({peptide:i[f],exposure:r[h]})).length>1&&(s=o(a,"cycle",t),u.total+=2,p.push(e.submit({model:d(s.signal),origin:{peptide:i[f],exposure:r[h],type:"signal"}}).then(l)),p.push(e.submit({model:d(s.background),origin:{peptide:i[f],exposure:r[h],type:"background"}}).then(l)));return Promise.all(p).then(function(){return n}).catch(function(e){console.error("kinetic something failed...",JSON.stringify(e))})}},i=function(e){var t,n,o,r,i,a,u,s=e.list("exposures");for(o=function(e){var t=1/0;return e.background_valid&&(t=Math.min(t,e.background)),e.signal_valid&&Math.min(t,e.signal),t},r=function(e,t){return"number"==typeof e&&"number"==typeof t?Math.min(e,t):"number"==typeof e?e:"number"==typeof t?t:1/0},a=e.list("cycles").reduce(r),t=0;t<s.length;t+=1)for(i=(u=e.get({cycle:a,exposure:s[t]})).map(o).reduce(r),u=e.get({exposure:s[t]}),n=0;n<u.length;n+=1)u[n].set("signal",u[n].signal-i),u[n].set("background",u[n].background-i);return e},t=function(e){return new Promise(function(t,o){e.data&&"object"==typeof e.data||o("Data object not added in. This will not work without it."),e.amd_ww&&"object"==typeof e.amd_ww||o("AMD_WW object not added in. This will not work without it."),e.equation&&"string"==typeof e.equation||o("Equation string not added in. This will not work without it."),e.worker&&"string"==typeof e.worker||o("String for worker url not added in. This will not work without it."),Array.isArray(e.data)||(e.data=[e.data]);var s,l,d;d=e.number_threads||void 0,l=e.amd_ww.start({filename:e.worker,num_workers:d}),console.log("\nStarting fits for outlier detection.\n"),s=Promise.all(e.data.map(n(l))).catch(function(e){o("Linear fit failed"+e)}),e.hasOwnProperty("linearUpdate")&&"function"==typeof e.linearUpdate&&e.linearUpdate(a),s.then(function(t){var n=Promise.all(t.map(r(l,e.equation)));return e.hasOwnProperty("kineticUpdate")&&"function"==typeof e.kineticUpdate&&e.kineticUpdate(u),n}).then(function(e){e=e.map(i),t(e)}).catch(function(e){o(e)})})},e.filter=t}("undefined"!=typeof module&&module.exports?module.exports:KINOME);