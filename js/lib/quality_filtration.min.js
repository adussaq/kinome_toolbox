!function(t){"use strict";var e,o,n,r,i={done:0,total:0},a={done:0,total:0};56.9441,.8,163.4145573051634,n=function(t,e,o){var n=0,r={x:[],y:[],valid:[],equation:{string:o}},i={x:[],y:[],valid:[],equation:{string:o}};for(n=0;n<t.length;n+=1)i.x.push(t[n][e]),i.y.push(t[n].signal),i.valid.push(t[n].signal_valid),r.x.push(t[n][e]),r.y.push(t[n].background),r.valid.push(t[n].background_valid);return{signal:i,background:r}},o=function(t){return function(e){if(!e.get||"function"!=typeof e.get)throw"Data object does not have get function attached. Use get_kinome.js to add this on.";var o,r,a,u,l,s=[];(e=e.clone()).level="1.0.1",l=function(o){var r,a,u,s=!1;if(o[1].robust&&o[1].remove>=0&&e.get(o[0])[o[1].remove].set(o[0].type+"_valid",0),!o[1].robust||o[1].remove>=0){for(r=0;!s&&r<o[1].errors.length;r+=1)Math.pow(o[1].errors[r].error,2)>56.9441&&(s=!0);if(s&&o[1].errors.length>3)return a=e.get(o[0]),u=n(a,"exposure","linear"),u[o[0].type].equation.robust=!0,t.submit({model:u[o[0].type],origin:o[0]}).then(l)}return i.done+=1,o[0].exposure=null,o[0].value=o[1].parameters[0],o[0].valid=o[1].R2>.8?1:0,null!==o[0].cycle&&e.append(o[0]),!0},o=e.list("cycle"),r=e.list("peptides");var d,c;for(d=0;d<r.length;d+=1)for(c=0;c<o.length;c+=1)(a=e.get({peptide:r[d],cycle:o[c]})).length>1&&(u=n(a,"exposure","linear"),i.total+=2,s.push(t.submit({model:u.signal,origin:{peptide:r[d],cycle:o[c],type:"signal"}}).then(l)),s.push(t.submit({model:u.background,origin:{peptide:r[d],cycle:o[c],type:"background"}}).then(l)));return Promise.all(s).then(function(){return e}).catch(function(t){console.log("something failed...",t)})}},r=function(t,e){return function(o){if(!o.get||"function"!=typeof o.get)throw"Data object does not have get function attached. Use get_kinome.js to add this on.";var r,i,u,l,s,d,c=[],p=[],f=0;o=o.clone(),d=function(t){var e,o;for(e=0;void 0===o&&e<t.y.length;e+=1)t.valid[e]&&(o=t.y[e]);for(o-=5,e=0;e<t.y.length;e+=1)t.y[e]-=o;return t},s=function(r){var i,u,l,p=!1;if(r[1].robust||r[1].errors.map(function(t){c.push(t.error+"\t"+t.y)}),r[1].robust&&r[1].remove>=0&&o.get(r[0])[r[1].remove].set(r[0].type+"_valid",0),!r[1].robust||r[1].remove>=0&&r[1].robust<4){for(i=0;!p&&i<r[1].errors.length;i+=1)Math.pow(r[1].errors[i].error,2)>163.4145573051634&&(p=!0);if(p&&r[1].errors.length>8)return r[1].robust||(f+=1),u=o.get(r[0]),l=n(u,"cycle",e),l[r[0].type].equation.robust=r[1].robust||0,l[r[0].type].equation.robust+=1,t.submit({model:d(l[r[0].type]),origin:r[0]}).then(s)}return a.done+=1,!0},r=o.list("exposure"),i=o.list("peptides");var g,h;for(g=0;g<i.length;g+=1)for(h=0;h<r.length;h+=1)(u=o.get({peptide:i[g],exposure:r[h]})).length>1&&(l=n(u,"cycle",e),a.total+=2,p.push(t.submit({model:d(l.signal),origin:{peptide:i[g],exposure:r[h],type:"signal"}}).then(s)),p.push(t.submit({model:d(l.background),origin:{peptide:i[g],exposure:r[h],type:"background"}}).then(s)));return Promise.all(p).then(function(){return o}).catch(function(t){console.error("kinetic something failed...",JSON.stringify(t))})}},e=function(t){return new Promise(function(e,n){t.data&&"object"==typeof t.data||n("Data object not added in. This will not work without it."),t.amd_ww&&"object"==typeof t.amd_ww||n("AMD_WW object not added in. This will not work without it."),t.equation&&"string"==typeof t.equation||n("Equation string not added in. This will not work without it."),t.worker&&"string"==typeof t.worker||n("String for worker url not added in. This will not work without it."),Array.isArray(t.data)||(t.data=[t.data]);var u,l,s;s=t.number_threads||void 0,l=t.amd_ww.start({filename:t.worker,num_workers:s}),console.log("\nStarting linear fits for outlier detection.\n"),u=Promise.all(t.data.map(o(l))).catch(function(t){n("Linear fit failed"+t)}),t.hasOwnProperty("linearUpdate")&&"function"==typeof t.linearUpdate&&t.linearUpdate(i),u.then(function(e){console.log("\nStarting kinetic fits for outlier detection.\n");var o=Promise.all(e.map(r(l,t.equation)));return t.hasOwnProperty("kineticUpdate")&&"function"==typeof t.kineticUpdate&&t.kineticUpdate(a),o}).then(function(t){e(t)}).catch(function(t){n(t)})})},t.filter=e}("undefined"!=typeof module&&module.exports?module.exports:KINOME);