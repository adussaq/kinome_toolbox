!function(e){"use strict";var a;require("bs_toggle-js"),require("bs_toggle-css","style"),a=function(e,a){var r,t,n,i,o,l,c,p,s,u,m,d,g={},k={},f={linear:{},kinetic:{}},h={};if(function(){var a,t;a=function(e,a){return Math.log(e.signal.parameters[g[a].param]/e.background.parameters[g[a].param])/Math.log(2)},t=function(e,a,r){var t=l(a,r);return e.signal.parameters[g[a].param]-e.background.parameters[g[a].param]<t?NaN:Math.log(100*(e.signal.parameters[g[a].param]-e.background.parameters[g[a].param]-t+1))/Math.log(2)},l=function(a,r){var t,n,o,l,c,p=[];if(l="kinetic"===a?{type:a,exposure:o=void 0!==r?r:i.exposure}:{type:a,cycle:o=void 0!==r?r:i.cycle},f[a][g[a].param]=f[a][g[a].param]||{},void 0!==f[a][g[a].param][o])c=f[a][g[a].param][o];else{for(t=e.get(l),n=0;n<t.length;n+=1)p.push(t[n].signal.parameters[g[a].param]-t[n].background.parameters[g[a].param]);c=(p=p.sort(function(e,a){return e-a}))[Math.floor(p.length/20)-1],f[a][g[a].param][o]=c}return c},u=[["Signal","signal",function(e,a){return e.signal.parameters[g[a].param]},"signal"],["Background","background",function(e,a){return e.background.parameters[g[a].param]},"background"],["log_2(s / b)",M.sToMathE("log_2({signal}/{background})").outerHTML,a,"log_2({signal}/{background})"],["log_2(100(s - b + c_e))",M.sToMathE("log_2{100(signal-background+c_e)}").outerHTML,t,"log_2{100(signal-background+c_e)}"]],r={kinetic:a,linear:a}}(),d=function(){},"object"==typeof a&&"function"==typeof a.change)return console.warn("The equation selector plugin overwrites the picker plugin change function. Any change function already set or color change function already set will be removed."),a.setColorFunc&&(p=a.setColorFunc,delete a.setColorFunc),s=a.change,delete a.change,g.linear={param:"0"},g.kinetic={param:"0"},n={linear:2,kinetic:2},c=function(e){var a=JSON.parse(JSON.stringify(e));i=e,g.sample&&g.sample.name===e.sample.name||(g.linear.params=e.sample.linear.equation.mathParams,g.kinetic.params=e.sample.kinetic.equation.mathParams,g.linear.equation_str=e.sample.linear.equation.mathType,g.kinetic.equation_str=e.sample.kinetic.equation.mathType,g.sample=e.sample,o("linear"),o("kinetic")),e.sample&&"function"==typeof e.sample.clone&&(a.sample=e.sample.clone()),a.eq={},a.eq.linear={eval:function(e,a){return r.linear(e,"linear",a)},parameter:g.linear.params[g.linear.param],equation_str:u[n.linear][3]},a.eq.kinetic={eval:function(e,a){return r.kinetic(e,"kinetic",a)},parameter:g.kinetic.params[g.kinetic.param],equation_str:u[n.kinetic][3]},d(a)},m=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},k.parameterSelector=$("<div>",{class:"row"}),k.linear={},k.kinetic={},k.linear.colHolder=$("<div>",{class:"col col-xs-12 col-sm-6"}),k.kinetic.colHolder=$("<div>",{class:"col col-xs-12 col-sm-6"}),k.linear.col=$("<div>"),k.kinetic.col=$("<div>"),k.linear.colHolder.append(k.linear.col),k.kinetic.colHolder.append(k.kinetic.col),k.buttons=[],o=function(e){var a,o,s,d,f=k[e];for(f.col.empty(),f.title=$("<div>"),f.title.append($("<h3>"+m(e)+" Options</h3>")),"function"==typeof p&&(o=$("<button>",{text:"Color By",class:"btn btn-default"}).click(function(){k.buttons.map(function(e){e.removeClass("active")}),k.buttons.map(function(e){e.text("Color By")}),$(this).addClass("active"),$(this).text("Colored By"),t!==e&&(t=e,c(i))}),f.title.append(o),k.buttons.push(o),t||o.click()),f.equationTitle=$("<h4>Model Parameterized</h4>"),f.equation=$("<div>",{style:"min-height: 40px;display: table;"}).append($("<div>",{style:"display: table-cell;vertical-align:middle;"}).append(M.sToMathE(g[e].equation_str))),f.parameterTitle=$("<h4>Parameter Viewing</h4>"),f.parameterPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),f.backCorrTitle=$("<h4>Background Correction</h4>"),f.backCorrPicker=$("<select>",{style:"vertical-align: middle",class:"form-control"}),f.backCorrSelected=$("<div>",{style:"margin-top:15px;",class:"text-center"}),f.col.append(f.title).append(f.equationTitle).append(f.equation).append(f.parameterTitle).append(f.parameterPicker).append(f.backCorrTitle).append(f.backCorrPicker).append(f.backCorrSelected),("undefined"===g[e].param||1*g[e].param>g[e].params.length)&&(g[e].param=0),a=0;a<g[e].params.length;a+=1)s=$('<option value="'+a+'">'+g[e].params[a]+"</option>"),1*g[e].param===a&&s.attr("selected","true"),f.parameterPicker.append(s);for(f.parameterPicker.change(function(a){var r=a.target.value;g[e].param=r,c(i)}),a=0;a<u.length;a+=1)s=$('<option value="'+a+'">'+u[a][0]+"</option>"),1*n[e]===a&&s.attr("selected","true"),f.backCorrPicker.append(s);f.backCorrPicker.change(function(a){var t=a.target.value;n[e]=t,r[e]=u[t][2],f.backCorrSelected.html(u[t][1]),"3"===t&&(d=1-l(e),f.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+d.toFixed(4)))),c(i)}),f.backCorrSelected.html(u[n[e]][1]),"3"===n[e]&&(d=1-l(e),f.backCorrSelected.append(",&nbsp;&nbsp;").append(M.sToMathE("c_e="+d.toFixed(4))))},k.parameterSelector.append(k.linear.colHolder).append(k.kinetic.colHolder),s(c),h.div=k.parameterSelector,h.col={kinetic:k.kinetic.col,linear:k.linear.col},h.change=function(e){"function"==typeof e&&(d=e),c(i)},"function"==typeof p&&(h.setColorFunc=function(e){p(function(a){return a.type=t,a.exec=function(e){return r[t](e,t)},a.parameter=g[t].params[g[t].param],e(a)})}),h;console.error("The equation selector requires a picker plugin object with a change function be passed in along with data.")},e.equationPicker=a}("undefined"!=typeof module&&module.exports?module.exports:KINOME);